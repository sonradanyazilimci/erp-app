<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP - Satƒ±≈ü ve Daƒüƒ±tƒ±m Y√∂netimi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 5px;
        }

        .header-left p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: rgba(149, 165, 166, 0.2);
            color: #2c3e50;
            border: 2px solid rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(149, 165, 166, 0.3);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .orders-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-header h2 {
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box, .filter-select {
            padding: 10px 15px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .sales-table th,
        .sales-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(149, 165, 166, 0.2);
        }

        .sales-table th {
            background: rgba(52, 152, 219, 0.1);
            color: #2c3e50;
            font-weight: bold;
            font-size: 1rem;
        }

        .sales-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-draft {
            background: #f8f9fa;
            color: #6c757d;
        }

        .status-confirmed {
            background: #cce5ff;
            color: #0066cc;
        }

        .status-preparing {
            background: #fff3cd;
            color: #856404;
        }

        .status-shipped {
            background: #e6f3ff;
            color: #0080ff;
        }

        .status-delivered {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-container, .customers-container, .analytics-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(149, 165, 166, 0.2);
            transition: background 0.3s ease;
        }

        .customer-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .customer-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .customer-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2c3e50;
            margin: 0;
        }

        .close {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(52, 152, 219, 0.05);
            border-radius: 8px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid rgba(149, 165, 166, 0.2);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #7f8c8d;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-style: italic;
            margin: 15px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            color: white;
            font-weight: bold;
        }

        .notification.show {
            transform: translateX(0);
        }

        .delivery-tracking {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .tracking-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }

        .tracking-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 3px;
            background: #ddd;
            z-index: 1;
        }

        .tracking-step.completed::after {
            background: #27ae60;
        }

        .step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            z-index: 2;
            position: relative;
        }

        .tracking-step.completed .step-icon {
            background: #27ae60;
        }

        .step-label {
            margin-top: 8px;
            font-size: 0.8rem;
            text-align: center;
            color: #7f8c8d;
        }

        .tracking-step.completed .step-label {
            color: #27ae60;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .sales-table {
                font-size: 0.9rem;
            }
            
            .sales-table th,
            .sales-table td {
                padding: 10px 8px;
            }

            .filter-controls {
                flex-direction: column;
                width: 100%;
            }

            .search-box, .filter-select {
                width: 100%;
            }

            .item-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .tracking-steps {
                flex-direction: column;
                gap: 20px;
            }

            .tracking-step::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>üì¶ Satƒ±≈ü ve Daƒüƒ±tƒ±m Y√∂netimi</h1>
                <p>Satƒ±≈ü sipari≈üleri, m√º≈üteriler ve teslimat s√ºre√ßlerini y√∂netin</p>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openSaleModal()">
                    ‚ûï Yeni Satƒ±≈ü
                </button>
                <button class="btn btn-secondary" onclick="openCustomerModal()">
                    üë§ M√º≈üteri Ekle
                </button>
                <a href="dashboard.html" class="btn btn-secondary">
                    üè† Dashboard'a D√∂n
                </a>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">üìã</div>
                <div class="stat-number" id="totalSales">0</div>
                <div class="stat-label">Toplam Satƒ±≈ü</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-number" id="totalRevenue">‚Ç∫0</div>
                <div class="stat-label">Toplam Ciro</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-number" id="totalCustomers">0</div>
                <div class="stat-label">M√º≈üteri Sayƒ±sƒ±</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üöö</div>
                <div class="stat-number" id="pendingDeliveries">0</div>
                <div class="stat-label">Bekleyen Teslimat</div>
            </div>
        </div>

        <div class="main-content">
            <div class="orders-container">
                <div class="table-header">
                    <h2>Satƒ±≈ü Sipari≈üleri</h2>
                    <div class="filter-controls">
                        <input type="text" class="search-box" placeholder="üîç Sipari≈ü ara..." id="searchInput" onkeyup="searchSales()">
                        <select class="filter-select" id="statusFilter" onchange="filterSales()">
                            <option value="">T√ºm Durumlar</option>
                            <option value="draft">Taslak</option>
                            <option value="confirmed">Onaylandƒ±</option>
                            <option value="preparing">Hazƒ±rlanƒ±yor</option>
                            <option value="shipped">Kargoda</option>
                            <option value="delivered">Teslim Edildi</option>
                            <option value="cancelled">ƒ∞ptal Edildi</option>
                        </select>
                    </div>
                </div>
                
                <table class="sales-table" id="salesTable">
                    <thead>
                        <tr>
                            <th>Sipari≈ü No</th>
                            <th>M√º≈üteri</th>
                            <th>Tarih</th>
                            <th>Toplam Tutar</th>
                            <th>Durum</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <!-- Dinamik olarak doldurulacak -->
                    </tbody>
                </table>
            </div>

            <div class="sidebar">
                <div class="customers-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">M√º≈üteriler</h3>
                    <div id="customersList">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>

                <div class="analytics-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Satƒ±≈ü Analizi</h3>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('daily')">G√ºnl√ºk</button>
                        <button class="tab" onclick="showTab('monthly')">Aylƒ±k</button>
                        <button class="tab" onclick="showTab('yearly')">Yƒ±llƒ±k</button>
                    </div>

                    <div id="daily" class="tab-content active">
                        <div class="chart-container">
                            üìä G√ºnl√ºk Satƒ±≈ü Grafiƒüi
                        </div>
                        <p><strong>Bug√ºn:</strong> <span id="todaySales">‚Ç∫0</span></p>
                        <p><strong>D√ºn:</strong> <span id="yesterdaySales">‚Ç∫0</span></p>
                    </div>

                    <div id="monthly" class="tab-content">
                        <div class="chart-container">
                            üìà Aylƒ±k Satƒ±≈ü Grafiƒüi
                        </div>
                        <p><strong>Bu Ay:</strong> <span id="thisMonthSales">‚Ç∫0</span></p>
                        <p><strong>Ge√ßen Ay:</strong> <span id="lastMonthSales">‚Ç∫0</span></p>
                    </div>

                    <div id="yearly" class="tab-content">
                        <div class="chart-container">
                            üìä Yƒ±llƒ±k Satƒ±≈ü Grafiƒüi
                        </div>
                        <p><strong>Bu Yƒ±l:</strong> <span id="thisYearSales">‚Ç∫0</span></p>
                        <p><strong>Ge√ßen Yƒ±l:</strong> <span id="lastYearSales">‚Ç∫0</span></p>
                    </div>
                </div>

                <div class="form-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Hƒ±zlƒ± ƒ∞≈ülemler</h3>
                    
                    <button class="btn btn-primary" onclick="openSaleModal()" style="width: 100%; margin-bottom: 10px;">
                        ‚ûï Yeni Satƒ±≈ü Sipari≈üi
                    </button>
                    
                    <button class="btn btn-secondary" onclick="openCustomerModal()" style="width: 100%; margin-bottom: 10px;">
                        üë§ M√º≈üteri Ekle
                    </button>
                    
                    <button class="btn btn-warning" onclick="showDeliveryReport()" style="width: 100%; margin-bottom: 10px;">
                        üöö Teslimat Raporu
                    </button>
                    
                    <button class="btn btn-success" onclick="exportSales()" style="width: 100%;">
                        üìÑ Satƒ±≈ülarƒ± Dƒ±≈üa Aktar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Satƒ±≈ü Modal -->
    <div id="saleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="saleModalTitle">Yeni Satƒ±≈ü Sipari≈üi</h2>
                <span class="close" onclick="closeSaleModal()">&times;</span>
            </div>
            
            <form id="saleForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Sipari≈ü No *</label>
                        <input type="text" id="saleNumber" required placeholder="Otomatik olu≈üturulacak" readonly>
                    </div>

                    <div class="form-group">
                        <label>M√º≈üteri *</label>
                        <select id="saleCustomer" required>
                            <option value="">M√º≈üteri se√ßiniz...</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Sipari≈ü Tarihi</label>
                        <input type="date" id="saleDate" required>
                    </div>

                    <div class="form-group">
                        <label>Teslimat Tarihi</label>
                        <input type="date" id="deliveryDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>Sipari≈ü Kalemleri</label>
                    <div id="saleItems">
                        <!-- Sipari≈ü kalemleri buraya eklenecek -->
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addSaleItem()" style="margin-top: 10px;">
                        ‚ûï Kalem Ekle
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Teslimat Adresi</label>
                        <textarea id="deliveryAddress" placeholder="Teslimat adresi..." rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Notlar</label>
                        <textarea id="saleNotes" placeholder="Sipari≈ü notlarƒ±..." rows="3"></textarea>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px;">
                    <strong style="color: #2c3e50; font-size: 1.2rem;">Toplam Tutar: ‚Ç∫<span id="saleTotal">0.00</span></strong>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ‚úÖ Sipari≈üi Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeSaleModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- M√º≈üteri Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="customerModalTitle">Yeni M√º≈üteri Ekle</h2>
                <span class="close" onclick="closeCustomerModal()">&times;</span>
            </div>
            
            <form id="customerForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>M√º≈üteri Adƒ±/Firma *</label>
                        <input type="text" id="customerName" required placeholder="M√º≈üteri adƒ±nƒ± giriniz">
                    </div>

                    <div class="form-group">
                        <label>ƒ∞leti≈üim Ki≈üisi</label>
                        <input type="text" id="contactPerson" placeholder="ƒ∞leti≈üim ki≈üisi">
                    </div>

                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="customerPhone" placeholder="0555 123 45 67">
                    </div>

                    <div class="form-group">
                        <label>E-posta</label>
                        <input type="email" id="customerEmail" placeholder="ornek@musteri.com">
                    </div>
                </div>

                <div class="form-group">
                    <label>Adres</label>
                    <textarea id="customerAddress" placeholder="M√º≈üteri adresi..." rows="3"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Vergi No/TC</label>
                        <input type="text" id="taxNumber" placeholder="Vergi numarasƒ±">
                    </div>

                    <div class="form-group">
                        <label>M√º≈üteri Tipi</label>
                        <select id="customerType">
                            <option value="individual">Bireysel</option>
                            <option value="corporate">Kurumsal</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                                                ‚úÖ M√º≈üteriyi Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeCustomerModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Teslimat Takip Modal -->
    <div id="trackingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Teslimat Takibi</h2>
                <span class="close" onclick="closeTrackingModal()">&times;</span>
            </div>
            
            <div id="trackingContent">
                <!-- Teslimat takip i√ßeriƒüi buraya gelecek -->
            </div>
        </div>
    </div>

    <!-- Bildirim -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Veri depolama
        let salesOrders = JSON.parse(localStorage.getItem('salesOrders')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let stockData = JSON.parse(localStorage.getItem('stockData')) || [];
        let editingSaleId = null;
        let editingCustomerId = null;

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            loadSalesTable();
            loadCustomersList();
            updateStats();
            updateAnalytics();
            
            // Form submit olaylarƒ±
            document.getElementById('saleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSale();
            });

            document.getElementById('customerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCustomer();
            });

            // Bug√ºn√ºn tarihini varsayƒ±lan olarak ayarla
            document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
        });

        // Ba≈ülangƒ±√ß verilerini y√ºkle
        function initializeData() {
            if (customers.length === 0) {
                customers = [
                    {
                        id: 1,
                        name: 'Ahmet Yƒ±lmaz',
                        contactPerson: 'Ahmet Yƒ±lmaz',
                        phone: '0555 123 45 67',
                        email: 'ahmet@email.com',
                        address: 'Kadƒ±k√∂y Mahallesi, ƒ∞stanbul Cad. No:25 Kadƒ±k√∂y/ƒ∞stanbul',
                        taxNumber: '12345678901',
                        customerType: 'individual',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'TechCorp A.≈û.',
                        contactPerson: 'Fatma Demir',
                        phone: '0212 555 67 89',
                        email: 'fatma@techcorp.com',
                        address: 'Maslak Mahallesi, Teknoloji Cad. No:45 Sarƒ±yer/ƒ∞stanbul',
                        taxNumber: '1234567890',
                        customerType: 'corporate',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: '√ñzlem Market',
                        contactPerson: '√ñzlem Kaya',
                        phone: '0312 444 55 66',
                        email: 'ozlem@ozlemmarket.com',
                        address: 'Kƒ±zƒ±lay Meydanƒ± No:78 √áankaya/Ankara',
                        taxNumber: '9876543210',
                        customerType: 'corporate',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('customers', JSON.stringify(customers));
            }

            if (salesOrders.length === 0) {
                salesOrders = [
                    {
                        id: 1,
                        orderNumber: 'SO-2025-001',
                        customerId: 1,
                        orderDate: '2025-07-01',
                        deliveryDate: '2025-07-05',
                        status: 'confirmed',
                        items: [
                            { productName: 'Laptop Dell Inspiron', quantity: 2, unitPrice: 15000, total: 30000 },
                            { productName: 'Wireless Mouse', quantity: 2, unitPrice: 150, total: 300 }
                        ],
                        totalAmount: 30300,
                        deliveryAddress: 'Kadƒ±k√∂y Mahallesi, ƒ∞stanbul Cad. No:25 Kadƒ±k√∂y/ƒ∞stanbul',
                        notes: 'Hƒ±zlƒ± teslimat istendi',
                        trackingNumber: 'TRK123456789',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        orderNumber: 'SO-2025-002',
                        customerId: 2,
                        orderDate: '2025-06-30',
                        deliveryDate: '2025-07-08',
                        status: 'preparing',
                        items: [
                            { productName: 'Ofis Sandalyesi Premium', quantity: 10, unitPrice: 1200, total: 12000 },
                            { productName: '√áalƒ±≈üma Masasƒ±', quantity: 5, unitPrice: 2500, total: 12500 }
                        ],
                        totalAmount: 24500,
                        deliveryAddress: 'Maslak Mahallesi, Teknoloji Cad. No:45 Sarƒ±yer/ƒ∞stanbul',
                        notes: 'Kurumsal sipari≈ü - Fatura gerekli',
                        trackingNumber: 'TRK987654321',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        orderNumber: 'SO-2025-003',
                        customerId: 3,
                        orderDate: '2025-06-28',
                        deliveryDate: '2025-07-02',
                        status: 'delivered',
                        items: [
                            { productName: 'Kasa Sistemi', quantity: 1, unitPrice: 8500, total: 8500 },
                            { productName: 'Barkod Okuyucu', quantity: 3, unitPrice: 450, total: 1350 }
                        ],
                        totalAmount: 9850,
                        deliveryAddress: 'Kƒ±zƒ±lay Meydanƒ± No:78 √áankaya/Ankara',
                        notes: 'Market ekipmanlarƒ±',
                        trackingNumber: 'TRK456789123',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('salesOrders', JSON.stringify(salesOrders));
            }
        }

        // Satƒ±≈ü sipari≈üleri tablosunu y√ºkle
        function loadSalesTable() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';

            salesOrders.forEach((order, index) => {
                const customer = customers.find(c => c.id === order.customerId);
                const customerName = customer ? customer.name : 'Bilinmeyen M√º≈üteri';
                const statusInfo = getStatusInfo(order.status);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${order.orderNumber}</strong></td>
                    <td>${customerName}</td>
                    <td>${formatDate(order.orderDate)}</td>
                    <td><strong>‚Ç∫${order.totalAmount.toFixed(2)}</strong></td>
                    <td><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="viewSale(${index})" title="G√∂r√ºnt√ºle">üëÅÔ∏è</button>
                            <button class="btn btn-warning btn-small" onclick="editSale(${index})" title="D√ºzenle">‚úèÔ∏è</button>
                            <button class="btn btn-secondary btn-small" onclick="trackDelivery(${index})" title="Takip">üöö</button>
                            <button class="btn btn-success btn-small" onclick="changeSaleStatus(${index})" title="Durum">üîÑ</button>
                            <button class="btn btn-danger btn-small" onclick="deleteSale(${index})" title="Sil">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
            });
        }

        // M√º≈üteriler listesini y√ºkle
        function loadCustomersList() {
            const container = document.getElementById('customersList');
            container.innerHTML = '';

            if (customers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Hen√ºz m√º≈üteri eklenmemi≈ü</p>';
                return;
            }

            customers.slice(0, 5).forEach((customer, index) => {
                const customerDiv = document.createElement('div');
                customerDiv.className = 'customer-item';
                customerDiv.innerHTML = `
                    <div class="customer-info">
                        <h4>${customer.name}</h4>
                        <p>${customer.phone} - ${customer.customerType === 'corporate' ? 'Kurumsal' : 'Bireysel'}</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary btn-small" onclick="editCustomer(${index})" title="D√ºzenle">‚úèÔ∏è</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCustomer(${index})" title="Sil">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(customerDiv);
            });

            // M√º≈üteri se√ßim listesini g√ºncelle
            loadCustomerOptions();
        }

        // M√º≈üteri se√ßeneklerini y√ºkle
        function loadCustomerOptions() {
            const select = document.getElementById('saleCustomer');
            select.innerHTML = '<option value="">M√º≈üteri se√ßiniz...</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                select.appendChild(option);
            });
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            const totalSales = salesOrders.length;
            const totalRevenue = salesOrders
                .filter(order => order.status !== 'cancelled')
                .reduce((sum, order) => sum + order.totalAmount, 0);
            const totalCustomers = customers.length;
            const pendingDeliveries = salesOrders.filter(order => 
                ['confirmed', 'preparing', 'shipped'].includes(order.status)
            ).length;

            document.getElementById('totalSales').textContent = totalSales;
            document.getElementById('totalRevenue').textContent = `‚Ç∫${totalRevenue.toFixed(2)}`;
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('pendingDeliveries').textContent = pendingDeliveries;
        }

        // Analitikleri g√ºncelle
        function updateAnalytics() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const thisMonth = today.getMonth();
            const lastMonth = thisMonth === 0 ? 11 : thisMonth - 1;
            
            const thisYear = today.getFullYear();
            const lastYear = thisYear - 1;

            // G√ºnl√ºk satƒ±≈ülar
            const todaySales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.toDateString() === today.toDateString() && order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            const yesterdaySales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.toDateString() === yesterday.toDateString() && order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            // Aylƒ±k satƒ±≈ülar
            const thisMonthSales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.getMonth() === thisMonth && 
                           orderDate.getFullYear() === thisYear && 
                           order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            const lastMonthSales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.getMonth() === lastMonth && 
                           orderDate.getFullYear() === (lastMonth === 11 ? thisYear - 1 : thisYear) && 
                           order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            // Yƒ±llƒ±k satƒ±≈ülar
            const thisYearSales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.getFullYear() === thisYear && order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            const lastYearSales = salesOrders
                .filter(order => {
                    const orderDate = new Date(order.orderDate);
                    return orderDate.getFullYear() === lastYear && order.status !== 'cancelled';
                })
                .reduce((sum, order) => sum + order.totalAmount, 0);

            // Deƒüerleri g√ºncelle
            document.getElementById('todaySales').textContent = `‚Ç∫${todaySales.toFixed(2)}`;
            document.getElementById('yesterdaySales').textContent = `‚Ç∫${yesterdaySales.toFixed(2)}`;
            document.getElementById('thisMonthSales').textContent = `‚Ç∫${thisMonthSales.toFixed(2)}`;
            document.getElementById('lastMonthSales').textContent = `‚Ç∫${lastMonthSales.toFixed(2)}`;
            document.getElementById('thisYearSales').textContent = `‚Ç∫${thisYearSales.toFixed(2)}`;
            document.getElementById('lastYearSales').textContent = `‚Ç∫${lastYearSales.toFixed(2)}`;
        }

        // Satƒ±≈ü modal a√ßma
        function openSaleModal() {
            editingSaleId = null;
            document.getElementById('saleModalTitle').textContent = 'Yeni Satƒ±≈ü Sipari≈üi';
            document.getElementById('saleForm').reset();
            document.getElementById('saleNumber').value = generateSaleNumber();
            document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('saleItems').innerHTML = '';
            document.getElementById('saleTotal').textContent = '0.00';
            addSaleItem(); // ƒ∞lk kalemi ekle
            document.getElementById('saleModal').style.display = 'block';
        }

        // Satƒ±≈ü modal kapatma
        function closeSaleModal() {
            document.getElementById('saleModal').style.display = 'none';
            editingSaleId = null;
        }

        // M√º≈üteri modal a√ßma
        function openCustomerModal() {
            editingCustomerId = null;
            document.getElementById('customerModalTitle').textContent = 'Yeni M√º≈üteri Ekle';
            document.getElementById('customerForm').reset();
            document.getElementById('customerModal').style.display = 'block';
        }

        // M√º≈üteri modal kapatma
        function closeCustomerModal() {
            document.getElementById('customerModal').style.display = 'none';
            editingCustomerId = null;
        }

        // Teslimat takip modal kapatma
        function closeTrackingModal() {
            document.getElementById('trackingModal').style.display = 'none';
        }

        // Satƒ±≈ü numarasƒ± olu≈ütur
        function generateSaleNumber() {
            const year = new Date().getFullYear();
            const orderCount = salesOrders.length + 1;
            return `SO-${year}-${orderCount.toString().padStart(3, '0')}`;
        }

        // Satƒ±≈ü kalemi ekle
        function addSaleItem() {
            const container = document.getElementById('saleItems');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-row';
            itemDiv.innerHTML = `
                <input type="text" placeholder="√úr√ºn adƒ±" class="item-product" onchange="calculateSaleTotal()">
                <input type="number" placeholder="Miktar" min="1" class="item-quantity" onchange="calculateSaleTotal()">
                <input type="number" placeholder="Birim fiyat" min="0" step="0.01" class="item-price" onchange="calculateSaleTotal()">
                <input type="number" placeholder="Toplam" class="item-total" readonly>
                <button type="button" class="btn btn-danger btn-small" onclick="removeSaleItem(this)">‚ùå</button>
            `;
            container.appendChild(itemDiv);
        }

        // Satƒ±≈ü kalemi sil
        function removeSaleItem(button) {
            button.parentElement.remove();
            calculateSaleTotal();
        }

        // Satƒ±≈ü toplamƒ±nƒ± hesapla
        function calculateSaleTotal() {
            const itemRows = document.querySelectorAll('#saleItems .item-row');
            let total = 0;

            itemRows.forEach(row => {
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const itemTotal = quantity * price;
                
                row.querySelector('.item-total').value = itemTotal.toFixed(2);
                total += itemTotal;
            });

            document.getElementById('saleTotal').textContent = total.toFixed(2);
        }

        // Satƒ±≈ü kaydet
        function saveSale() {
            const saleData = {
                orderNumber: document.getElementById('saleNumber').value,
                customerId: parseInt(document.getElementById('saleCustomer').value),
                orderDate: document.getElementById('saleDate').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                status: 'draft',
                deliveryAddress: document.getElementById('deliveryAddress').value,
                notes: document.getElementById('saleNotes').value,
                trackingNumber: generateTrackingNumber(),
                createdAt: new Date().toISOString()
            };

            // Sipari≈ü kalemlerini topla
            const itemRows = document.querySelectorAll('#saleItems .item-row');
            const items = [];
            let totalAmount = 0;

            itemRows.forEach(row => {
                const productName = row.querySelector('.item-product').value;
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const unitPrice = parseFloat(row.querySelector('.item-price').value) || 0;
                const total = quantity * unitPrice;

                if (productName && quantity > 0 && unitPrice > 0) {
                    items.push({
                        productName,
                        quantity,
                        unitPrice,
                        total
                    });
                    totalAmount += total;
                }
            });

            if (items.length === 0) {
                showNotification('En az bir satƒ±≈ü kalemi eklemelisiniz!', 'error');
                return;
            }

            if (!saleData.customerId) {
                showNotification('L√ºtfen bir m√º≈üteri se√ßiniz!', 'error');
                return;
            }

            saleData.items = items;
            saleData.totalAmount = totalAmount;

            if (editingSaleId !== null) {
                saleData.id = salesOrders[editingSaleId].id;
                salesOrders[editingSaleId] = saleData;
                showNotification('Satƒ±≈ü sipari≈üi ba≈üarƒ±yla g√ºncellendi!', 'success');
            } else {
                saleData.id = Date.now();
                salesOrders.push(saleData);
                showNotification('Satƒ±≈ü sipari≈üi ba≈üarƒ±yla olu≈üturuldu!', 'success');
            }

            localStorage.setItem('salesOrders', JSON.stringify(salesOrders));
            loadSalesTable();
            updateStats();
            updateAnalytics();
            closeSaleModal();
        }

        // M√º≈üteri kaydet
        function saveCustomer() {
            const customerData = {
                name: document.getElementById('customerName').value,
                contactPerson: document.getElementById('contactPerson').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                address: document.getElementById('customerAddress').value,
                taxNumber: document.getElementById('taxNumber').value,
                customerType: document.getElementById('customerType').value,
                createdAt: new Date().toISOString()
            };

            if (editingCustomerId !== null) {
                customerData.id = customers[editingCustomerId].id;
                customers[editingCustomerId] = customerData;
                showNotification('M√º≈üteri ba≈üarƒ±yla g√ºncellendi!', 'success');
            } else {
                customerData.id = Date.now();
                customers.push(customerData);
                showNotification('M√º≈üteri ba≈üarƒ±yla eklendi!', 'success');
            }

            localStorage.setItem('customers', JSON.stringify(customers));
            loadCustomersList();
            updateStats();
            closeCustomerModal();
        }

        // Takip numarasƒ± olu≈ütur
        function generateTrackingNumber() {
            return 'TRK' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        // Satƒ±≈ü d√ºzenle
        function editSale(index) {
            editingSaleId = index;
            const sale = salesOrders[index];
            
            document.getElementById('saleModalTitle').textContent = 'Satƒ±≈ü Sipari≈üini D√ºzenle';
            document.getElementById('saleNumber').value = sale.orderNumber;
            document.getElementById('saleCustomer').value = sale.customerId;
            document.getElementById('saleDate').value = sale.orderDate;
            document.getElementById('deliveryDate').value = sale.deliveryDate || '';
            document.getElementById('deliveryAddress').value = sale.deliveryAddress || '';
            document.getElementById('saleNotes').value = sale.notes || '';

            // Sipari≈ü kalemlerini y√ºkle
            const container = document.getElementById('saleItems');
            container.innerHTML = '';
            
            sale.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-row';
                itemDiv.innerHTML = `
                    <input type="text" placeholder="√úr√ºn adƒ±" class="item-product" value="${item.productName}" onchange="calculateSaleTotal()">
                    <input type="number" placeholder="Miktar" min="1" class="item-quantity" value="${item.quantity}" onchange="calculateSaleTotal()">
                    <input type="number" placeholder="Birim fiyat" min="0" step="0.01" class="item-price" value="${item.unitPrice}" onchange="calculateSaleTotal()">
                    <input type="number" placeholder="Toplam" class="item-total" value="${item.total.toFixed(2)}" readonly>
                    <button type="button" class="btn btn-danger btn-small" onclick="removeSaleItem(this)">‚ùå</button>
                `;
                container.appendChild(itemDiv);
            });

            calculateSaleTotal();
            document.getElementById('saleModal').style.display = 'block';
        }

        // M√º≈üteri d√ºzenle
        function editCustomer(index) {
            editingCustomerId = index;
            const customer = customers[index];
            
            document.getElementById('customerModalTitle').textContent = 'M√º≈üteriyi D√ºzenle';
            document.getElementById('customerName').value = customer.name;
            document.getElementById('contactPerson').value = customer.contactPerson || '';
            document.getElementById('customerPhone').value = customer.phone || '';
            document.getElementById('customerEmail').value = customer.email || '';
            document.getElementById('customerAddress').value = customer.address || '';
            document.getElementById('taxNumber').value = customer.taxNumber || '';
            document.getElementById('customerType').value = customer.customerType || 'individual';
            
            document.getElementById('customerModal').style.display = 'block';
        }

        // Satƒ±≈ü g√∂r√ºnt√ºle
        function viewSale(index) {
            const sale = salesOrders[index];
            const customer = customers.find(c => c.id === sale.customerId);
            const customerName = customer ? customer.name : 'Bilinmeyen M√º≈üteri';
            
            let itemsHtml = '';
            sale.items.forEach(item => {
                itemsHtml += `
                    <tr>
                        <td>${item.productName}</td>
                        <td>${item.quantity}</td>
                        <td>‚Ç∫${item.unitPrice.toFixed(2)}</td>
                        <td><strong>‚Ç∫${item.total.toFixed(2)}</strong></td>
                    </tr>
                `;
            });

            const statusInfo = getStatusInfo(sale.status);
            
            const content = `
                <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px;">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Satƒ±≈ü Sipari≈üi Detaylarƒ±</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <strong>Sipari≈ü No:</strong> ${sale.orderNumber}<br>
                            <strong>M√º≈üteri:</strong> ${customerName}<br>
                            <strong>Sipari≈ü Tarihi:</strong> ${formatDate(sale.orderDate)}<br>
                            <strong>Takip No:</strong> ${sale.trackingNumber || 'Hen√ºz atanmadƒ±'}
                        </div>
                        <div>
                            <strong>Teslimat Tarihi:</strong> ${sale.deliveryDate ? formatDate(sale.deliveryDate) : 'Belirtilmemi≈ü'}<br>
                            <strong>Durum:</strong> <span class="status-badge ${statusInfo.class}">${statusInfo.text}</span><br>
                            <strong>Toplam Tutar:</strong> <span style="color: #27ae60; font-size: 1.2rem;">‚Ç∫${sale.totalAmount.toFixed(2)}</span>
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 20px 0 10px 0;">Sipari≈ü Kalemleri</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(52, 152, 219, 0.1);">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">√úr√ºn</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Miktar</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Birim Fiyat</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Toplam</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>

                    ${sale.deliveryAddress ? `<div style="margin-top: 15px;"><strong>Teslimat Adresi:</strong><br>${sale.deliveryAddress}</div>` : ''}
                    ${sale.notes ? `<div style="margin-top: 15px;"><strong>Notlar:</strong><br>${sale.notes}</div>` : ''}
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="closeViewModal()">Kapat</button>
                    </div>
                </div>
            `;
            
            showModal('Satƒ±≈ü Sipari≈üi Detaylarƒ±', content);
        }

        // Teslimat takibi
        function trackDelivery(index) {
            const sale = salesOrders[index];
            const customer = customers.find(c => c.id === sale.customerId);
            const customerName = customer ? customer.name : 'Bilinmeyen M√º≈üteri';
            
            const steps = [
                { id: 'confirmed', label: 'Sipari≈ü Onaylandƒ±', completed: ['confirmed', 'preparing', 'shipped', 'delivered'].includes(sale.status) },
                { id: 'preparing', label: 'Hazƒ±rlanƒ±yor', completed: ['preparing', 'shipped', 'delivered'].includes(sale.status) },
                { id: 'shipped', label: 'Kargoya Verildi', completed: ['shipped', 'delivered'].includes(sale.status) },
                { id: 'delivered', label: 'Teslim Edildi', completed: sale.status === 'delivered' }
            ];

            let stepsHtml = '';
            steps.forEach(step => {
                stepsHtml += `
                    <div class="tracking-step ${step.completed ? 'completed' : ''}">
                        <div class="step-icon">${step.completed ? '‚úì' : '‚óã'}</div>
                        <div class="step-label">${step.label}</div>
                    </div>
                `;
            });

            const content = `
                <div class="delivery-tracking">
                                        <h3 style="color: #2c3e50; margin-bottom: 15px;">Teslimat Takibi</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <p><strong>Sipari≈ü No:</strong> ${sale.orderNumber}</p>
                        <p><strong>M√º≈üteri:</strong> ${customerName}</p>
                        <p><strong>Takip No:</strong> ${sale.trackingNumber || 'Hen√ºz atanmadƒ±'}</p>
                    </div>

                    <div class="tracking-steps">
                        ${stepsHtml}
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 10px;">
                        <p><strong>Mevcut Durum:</strong> ${getStatusInfo(sale.status).text}</p>
                        ${sale.deliveryAddress ? `<p><strong>Teslimat Adresi:</strong> ${sale.deliveryAddress}</p>` : ''}
                        <p><strong>Tahmini Teslimat:</strong> ${sale.deliveryDate ? formatDate(sale.deliveryDate) : 'Belirtilmemi≈ü'}</p>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="updateTrackingStatus(${index})" style="margin-right: 10px;">Durumu G√ºncelle</button>
                        <button class="btn btn-secondary" onclick="closeTrackingModal()">Kapat</button>
                    </div>
                </div>
            `;
            
            document.getElementById('trackingContent').innerHTML = content;
            document.getElementById('trackingModal').style.display = 'block';
        }

        // Takip durumu g√ºncelle
        function updateTrackingStatus(index) {
            const sale = salesOrders[index];
            const statuses = [
                { value: 'draft', text: 'Taslak' },
                { value: 'confirmed', text: 'Onaylandƒ±' },
                { value: 'preparing', text: 'Hazƒ±rlanƒ±yor' },
                { value: 'shipped', text: 'Kargoda' },
                { value: 'delivered', text: 'Teslim Edildi' },
                { value: 'cancelled', text: 'ƒ∞ptal Edildi' }
            ];

            let optionsHtml = '';
            statuses.forEach(status => {
                const selected = status.value === sale.status ? 'selected' : '';
                optionsHtml += `<option value="${status.value}" ${selected}>${status.text}</option>`;
            });

            const content = `
                <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Sipari≈ü Durumu G√ºncelle</h3>
                    <p style="margin-bottom: 15px;"><strong>Sipari≈ü:</strong> ${sale.orderNumber}</p>
                    
                    <div class="form-group">
                        <label>Yeni Durum:</label>
                        <select id="newSaleStatus" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                            ${optionsHtml}
                        </select>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="updateSaleStatus(${index})">G√ºncelle</button>
                        <button class="btn btn-secondary" onclick="closeViewModal()" style="margin-left: 10px;">ƒ∞ptal</button>
                    </div>
                </div>
            `;
            
            showModal('Durum G√ºncelle', content);
        }

        // Satƒ±≈ü durumu deƒüi≈ütir
        function changeSaleStatus(index) {
            updateTrackingStatus(index);
        }

        // Satƒ±≈ü durumunu g√ºncelle
        function updateSaleStatus(index) {
            const newStatus = document.getElementById('newSaleStatus').value;
            salesOrders[index].status = newStatus;
            
            localStorage.setItem('salesOrders', JSON.stringify(salesOrders));
            loadSalesTable();
            updateStats();
            updateAnalytics();
            closeViewModal();
            closeTrackingModal();
            
            const statusInfo = getStatusInfo(newStatus);
            showNotification(`Sipari≈ü durumu "${statusInfo.text}" olarak g√ºncellendi!`, 'success');
        }

        // Satƒ±≈ü sil
        function deleteSale(index) {
            const sale = salesOrders[index];
            if (confirm(`"${sale.orderNumber}" numaralƒ± sipari≈üi silmek istediƒüinizden emin misiniz?`)) {
                salesOrders.splice(index, 1);
                localStorage.setItem('salesOrders', JSON.stringify(salesOrders));
                loadSalesTable();
                updateStats();
                updateAnalytics();
                showNotification('Satƒ±≈ü sipari≈üi ba≈üarƒ±yla silindi!', 'success');
            }
        }

        // M√º≈üteri sil
        function deleteCustomer(index) {
            const customer = customers[index];
            
            // Bu m√º≈üteriye ait sipari≈ü var mƒ± kontrol et
            const hasOrders = salesOrders.some(order => order.customerId === customer.id);
            
            if (hasOrders) {
                showNotification('Bu m√º≈üteriye ait sipari≈üler bulunduƒüu i√ßin silinemez!', 'error');
                return;
            }
            
            if (confirm(`"${customer.name}" m√º≈üterisini silmek istediƒüinizden emin misiniz?`)) {
                customers.splice(index, 1);
                localStorage.setItem('customers', JSON.stringify(customers));
                loadCustomersList();
                updateStats();
                showNotification('M√º≈üteri ba≈üarƒ±yla silindi!', 'success');
            }
        }

        // Satƒ±≈ü arama
        function searchSales() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#salesTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Satƒ±≈ü filtreleme
        function filterSales() {
            const filterStatus = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#salesTableBody tr');
            
            rows.forEach((row, index) => {
                if (!filterStatus) {
                    row.style.display = '';
                } else {
                    const sale = salesOrders[index];
                    row.style.display = sale.status === filterStatus ? '' : 'none';
                }
            });
        }

        // Teslimat raporu
        function showDeliveryReport() {
            const pendingDeliveries = salesOrders.filter(order => 
                ['confirmed', 'preparing', 'shipped'].includes(order.status)
            );
            
            if (pendingDeliveries.length === 0) {
                showNotification('Bekleyen teslimat bulunmuyor!', 'success');
                return;
            }

            let reportHtml = '<h3 style="color: #f39c12; margin-bottom: 15px;">üöö Teslimat Raporu</h3>';
            reportHtml += '<table style="width: 100%; border-collapse: collapse;">';
            reportHtml += '<thead><tr style="background: rgba(243, 156, 18, 0.1);"><th style="padding: 10px; border-bottom: 1px solid #ddd;">Sipari≈ü No</th><th style="padding: 10px; border-bottom: 1px solid #ddd;">M√º≈üteri</th><th style="padding: 10px; border-bottom: 1px solid #ddd;">Durum</th><th style="padding: 10px; border-bottom: 1px solid #ddd;">Teslimat Tarihi</th></tr></thead>';
            reportHtml += '<tbody>';
            
            pendingDeliveries.forEach(order => {
                const customer = customers.find(c => c.id === order.customerId);
                const customerName = customer ? customer.name : 'Bilinmeyen';
                const statusInfo = getStatusInfo(order.status);
                
                reportHtml += `<tr>
                    <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.orderNumber}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee;">${customerName}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></td>
                    <td style="padding: 10px; border-bottom: 1px solid #eee;">${order.deliveryDate ? formatDate(order.deliveryDate) : 'Belirtilmemi≈ü'}</td>
                </tr>`;
            });
            
            reportHtml += '</tbody></table>';
            reportHtml += '<div style="text-align: center; margin-top: 20px;"><button class="btn btn-secondary" onclick="closeViewModal()">Kapat</button></div>';
            
            showModal('Teslimat Raporu', reportHtml);
        }

        // Satƒ±≈ülarƒ± dƒ±≈üa aktar
        function exportSales() {
            if (salesOrders.length === 0) {
                showNotification('Dƒ±≈üa aktarƒ±lacak satƒ±≈ü bulunamadƒ±!', 'warning');
                return;
            }

            let csvContent = 'Sipari≈ü No,M√º≈üteri,Tarih,Teslimat Tarihi,Durum,Toplam Tutar,Takip No,Notlar\n';
            
            salesOrders.forEach(order => {
                const customer = customers.find(c => c.id === order.customerId);
                const customerName = customer ? customer.name : 'Bilinmeyen';
                const statusInfo = getStatusInfo(order.status);
                
                csvContent += `"${order.orderNumber}","${customerName}","${order.orderDate}","${order.deliveryDate || ''}","${statusInfo.text}","${order.totalAmount.toFixed(2)}","${order.trackingNumber || ''}","${order.notes || ''}"\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `satis_siparisleri_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Satƒ±≈ü sipari≈üleri ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±!', 'success');
        }

        // Tab g√∂sterme
        function showTab(tabName) {
            // T√ºm tablarƒ± gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // T√ºm tab butonlarƒ±nƒ± pasif yap
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Se√ßilen tabƒ± g√∂ster
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Yardƒ±mcƒ± fonksiyonlar
        function getStatusInfo(status) {
            const statuses = {
                'draft': { class: 'status-draft', text: 'Taslak' },
                'confirmed': { class: 'status-confirmed', text: 'Onaylandƒ±' },
                'preparing': { class: 'status-preparing', text: 'Hazƒ±rlanƒ±yor' },
                'shipped': { class: 'status-shipped', text: 'Kargoda' },
                'delivered': { class: 'status-delivered', text: 'Teslim Edildi' },
                'cancelled': { class: 'status-cancelled', text: 'ƒ∞ptal Edildi' }
            };
            return statuses[status] || { class: 'status-draft', text: 'Bilinmeyen' };
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>${title}</h2>
                        <span class="close" onclick="closeViewModal()">&times;</span>
                    </div>
                    ${content}
                </div>
            `;
            document.body.appendChild(modal);
            window.currentViewModal = modal;
        }

        function closeViewModal() {
            if (window.currentViewModal) {
                document.body.removeChild(window.currentViewModal);
                window.currentViewModal = null;
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            switch(type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'warning':
                    notification.style.background = '#f39c12';
                    break;
                default:
                    notification.style.background = '#3498db';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapatma
        window.onclick = function(event) {
            const saleModal = document.getElementById('saleModal');
            const customerModal = document.getElementById('customerModal');
            const trackingModal = document.getElementById('trackingModal');
            
            if (event.target == saleModal) {
                closeSaleModal();
            }
            if (event.target == customerModal) {
                closeCustomerModal();
            }
            if (event.target == trackingModal) {
                closeTrackingModal();
            }
        }
    </script>
</body>
</html>


