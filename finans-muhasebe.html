<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP - Finans ve Muhasebe Y√∂netimi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 5px;
        }

        .header-left p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: rgba(149, 165, 166, 0.2);
            color: #2c3e50;
            border: 2px solid rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(149, 165, 166, 0.3);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .positive {
            color: #27ae60 !important;
        }

        .negative {
            color: #e74c3c !important;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .transactions-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-header h2 {
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box, .filter-select {
            padding: 10px 15px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .transactions-table th,
        .transactions-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(149, 165, 166, 0.2);
        }

        .transactions-table th {
            background: rgba(52, 152, 219, 0.1);
            color: #2c3e50;
            font-weight: bold;
            font-size: 1rem;
        }

        .transactions-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .transaction-type {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .type-income {
            background: #d5f4e6;
            color: #27ae60;
        }

        .type-expense {
            background: #f8d7da;
            color: #e74c3c;
        }

        .type-transfer {
            background: #cce5ff;
            color: #0066cc;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-container, .accounts-container, .reports-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .account-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(149, 165, 166, 0.2);
            transition: background 0.3s ease;
        }

        .account-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .account-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .account-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .account-balance {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2c3e50;
            margin: 0;
        }

        .close {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid rgba(149, 165, 166, 0.2);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #7f8c8d;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-style: italic;
            margin: 15px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            color: white;
            font-weight: bold;
        }

        .notification.show {
            transform: translateX(0);
        }

        .invoice-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .invoice-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .invoice-table th,
        .invoice-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .invoice-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(52, 152, 219, 0.05);
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .budget-progress {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .budget-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .transactions-table {
                font-size: 0.9rem;
            }
            
            .transactions-table th,
            .transactions-table td {
                padding: 10px 8px;
            }

            .filter-controls {
                flex-direction: column;
                width: 100%;
            }

            .search-box, .filter-select {
                width: 100%;
            }

            .invoice-header {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>üí∞ Finans ve Muhasebe Y√∂netimi</h1>
                <p>Mali i≈ülemler, hesaplar ve finansal raporlarƒ± y√∂netin</p>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openTransactionModal()">
                    ‚ûï Yeni ƒ∞≈ülem
                </button>
                <button class="btn btn-secondary" onclick="openAccountModal()">
                    üè¶ Hesap Ekle
                </button>
                <button class="btn btn-warning" onclick="openInvoiceModal()">
                    üìÑ Fatura Olu≈ütur
                </button>
                <a href="dashboard.html" class="btn btn-secondary">
                    üè† Dashboard'a D√∂n
                </a>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">üí≥</div>
                <div class="stat-number" id="totalBalance">‚Ç∫0</div>
                <div class="stat-label">Toplam Bakiye</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-number positive" id="totalIncome">‚Ç∫0</div>
                <div class="stat-label">Toplam Gelir</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìâ</div>
                <div class="stat-number negative" id="totalExpense">‚Ç∫0</div>
                <div class="stat-label">Toplam Gider</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíπ</div>
                <div class="stat-number" id="netProfit">‚Ç∫0</div>
                <div class="stat-label">Net Kar/Zarar</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-number" id="monthlyRevenue">‚Ç∫0</div>
                <div class="stat-label">Aylƒ±k Ciro</div>
            </div>
        </div>

        <div class="main-content">
            <div class="transactions-container">
                <div class="table-header">
                    <h2>Mali ƒ∞≈ülemler</h2>
                    <div class="filter-controls">
                        <input type="text" class="search-box" placeholder="üîç ƒ∞≈ülem ara..." id="searchInput" onkeyup="searchTransactions()">
                        <select class="filter-select" id="typeFilter" onchange="filterTransactions()">
                            <option value="">T√ºm ƒ∞≈ülemler</option>
                            <option value="income">Gelir</option>
                            <option value="expense">Gider</option>
                            <option value="transfer">Transfer</option>
                        </select>
                        <input type="month" class="filter-select" id="monthFilter" onchange="filterTransactions()">
                    </div>
                </div>
                
                <table class="transactions-table" id="transactionsTable">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>A√ßƒ±klama</th>
                            <th>Kategori</th>
                            <th>Hesap</th>
                            <th>T√ºr</th>
                            <th>Tutar</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                        <!-- Dinamik olarak doldurulacak -->
                    </tbody>
                </table>
            </div>

            <div class="sidebar">
                <div class="accounts-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Hesaplar</h3>
                    <div id="accountsList">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>

                <div class="reports-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Finansal Raporlar</h3>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="showTab('cashflow')">Nakit Akƒ±≈üƒ±</button>
                        <button class="tab" onclick="showTab('budget')">B√ºt√ße</button>
                        <button class="tab" onclick="showTab('profit')">Kar/Zarar</button>
                    </div>

                    <div id="cashflow" class="tab-content active">
                        <div class="chart-container">
                            üìä Nakit Akƒ±≈üƒ± Grafiƒüi
                        </div>
                        <p><strong>Bu Ay Giri≈ü:</strong> <span id="monthlyIncome" class="positive">‚Ç∫0</span></p>
                        <p><strong>Bu Ay √áƒ±kƒ±≈ü:</strong> <span id="monthlyExpense" class="negative">‚Ç∫0</span></p>
                        <p><strong>Net Akƒ±≈ü:</strong> <span id="netCashflow">‚Ç∫0</span></p>
                    </div>

                    <div id="budget" class="tab-content">
                        <div class="chart-container">
                            üìà B√ºt√ße Takibi
                        </div>
                        <div id="budgetItems">
                            <!-- B√ºt√ße kalemleri buraya gelecek -->
                        </div>
                    </div>

                    <div id="profit" class="tab-content">
                        <div class="chart-container">
                            üíπ Kar/Zarar Analizi
                        </div>
                        <p><strong>Br√ºt Kar:</strong> <span id="grossProfit">‚Ç∫0</span></p>
                        <p><strong>Operasyonel Giderler:</strong> <span id="operationalExpenses">‚Ç∫0</span></p>
                        <p><strong>Net Kar:</strong> <span id="netProfitDetail">‚Ç∫0</span></p>
                    </div>
                </div>

                <div class="form-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Hƒ±zlƒ± ƒ∞≈ülemler</h3>
                    
                    <button class="btn btn-primary" onclick="openTransactionModal()" style="width: 100%; margin-bottom: 10px;">
                        ‚ûï Yeni Mali ƒ∞≈ülem
                    </button>
                    
                    <button class="btn btn-secondary" onclick="openAccountModal()" style="width: 100%; margin-bottom: 10px;">
                        üè¶ Hesap Ekle
                    </button>
                    
                    <button class="btn btn-warning" onclick="openInvoiceModal()" style="width: 100%; margin-bottom: 10px;">
                        üìÑ Fatura Olu≈ütur
                    </button>
                    
                    <button class="btn btn-success" onclick="exportFinancialReport()" style="width: 100%; margin-bottom: 10px;">
                        üìä Finansal Rapor
                    </button>
                    
                    <button class="btn btn-danger" onclick="openBudgetModal()" style="width: 100%;">
                        üéØ B√ºt√ße Planla
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ƒ∞≈ülem Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="transactionModalTitle">Yeni Mali ƒ∞≈ülem</h2>
                <span class="close" onclick="closeTransactionModal()">&times;</span>
            </div>
            
            <form id="transactionForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>ƒ∞≈ülem T√ºr√º *</label>
                        <select id="transactionType" required onchange="updateTransactionForm()">
                            <option value="">Se√ßiniz...</option>
                            <option value="income">Gelir</option>
                            <option value="expense">Gider</option>
                            <option value="transfer">Transfer</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tarih *</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>A√ßƒ±klama *</label>
                    <input type="text" id="transactionDescription" required placeholder="ƒ∞≈ülem a√ßƒ±klamasƒ±">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="transactionCategory">
                            <option value="">Se√ßiniz...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Hesap *</label>
                        <select id="transactionAccount" required>
                            <option value="">Hesap se√ßiniz...</option>
                        </select>
                    </div>
                </div>

                <div id="transferSection" style="display: none;">
                    <div class="form-group">
                        <label>Hedef Hesap *</label>
                        <select id="targetAccount">
                            <option value="">Hedef hesap se√ßiniz...</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Tutar *</label>
                        <input type="number" id="transactionAmount" required min="0" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>Para Birimi</label>
                        <select id="transactionCurrency">
                            <option value="TRY">‚Ç∫ T√ºrk Lirasƒ±</option>
                            <option value="USD">$ Amerikan Dolarƒ±</option>
                            <option value="EUR">‚Ç¨ Euro</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Notlar</label>
                    <textarea id="transactionNotes" placeholder="Ek notlar..." rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ‚úÖ ƒ∞≈ülemi Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeTransactionModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hesap Modal -->
    <div id="accountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="accountModalTitle">Yeni Hesap Ekle</h2>
                <span class="close" onclick="closeAccountModal()">&times;</span>
            </div>
            
            <form id="accountForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Hesap Adƒ± *</label>
                        <input type="text" id="accountName" required placeholder="Hesap adƒ±nƒ± giriniz">
                    </div>

                    <div class="form-group">
                        <label>Hesap T√ºr√º *</label>
                        <select id="accountType" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="cash">Nakit</option>
                            <option value="bank">Banka Hesabƒ±</option>
                            <option value="credit">Kredi Kartƒ±</option>
                            <option value="investment">Yatƒ±rƒ±m</option>
                            <option value="other">Diƒüer</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ba≈ülangƒ±√ß Bakiyesi</label>
                        <input type="number" id="initialBalance" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>Para Birimi</label>
                        <select id="accountCurrency">
                            <option value="TRY">‚Ç∫ T√ºrk Lirasƒ±</option>
                            <option value="USD">$ Amerikan Dolarƒ±</option>
                            <option value="EUR">‚Ç¨ Euro</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <textarea id="accountDescription" placeholder="Hesap a√ßƒ±klamasƒ±..." rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ‚úÖ Hesabƒ± Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeAccountModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Fatura Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2>Fatura Olu≈ütur</h2>
                <span class="close" onclick="closeInvoiceModal()">&times;</span>
            </div>
            
            <form id="invoiceForm">
                <div class="invoice-container">
                    <div class="invoice-header">
                        <div>
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">Fatura Bilgileri</h3>
                            <div class="form-group">
                                <label>Fatura No</label>
                                <input type="text" id="invoiceNumber" readonly>
                            </div>
                            <div class="form-group">
                                <label>Fatura Tarihi</label>
                                <input type="date" id="invoiceDate" required>
                            </div>
                            <div class="form-group">
                                <label>Vade Tarihi</label>
                                <input type="date" id="dueDate">
                            </div>
                        </div>
                        <div>
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">M√º≈üteri Bilgileri</h3>
                            <div class="form-group">
                                <label>M√º≈üteri</label>
                                <select id="invoiceCustomer" required>
                                    <option value="">M√º≈üteri se√ßiniz...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fatura T√ºr√º</label>
                                <select id="invoiceType">
                                    <option value="sales">Satƒ±≈ü Faturasƒ±</option>
                                    <option value="service">Hizmet Faturasƒ±</option>
                                    <option value="purchase">Alƒ±≈ü Faturasƒ±</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: #2c3e50; margin: 20px 0;">Fatura Kalemleri</h3>
                    <div id="invoiceItems">
                        <!-- Fatura kalemleri buraya eklenecek -->
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addInvoiceItem()" style="margin: 10px 0;">
                        ‚ûï Kalem Ekle
                    </button>

                    <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px; margin-top: 20px;">
                        <div class="form-group">
                            <label>Notlar</label>
                            <textarea id="invoiceNotes" placeholder="Fatura notlarƒ±..." rows="4"></textarea>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Ara Toplam:</span>
                                <span id="invoiceSubtotal">‚Ç∫0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>KDV (%18):</span>
                                <span id="invoiceVat">‚Ç∫0.00</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; border-top: 2px solid #ddd; padding-top: 10px;">
                                <span>Toplam:</span>
                                <span id="invoiceTotal">‚Ç∫0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ‚úÖ Faturayƒ± Kaydet
                    </button>
                    <button type="button" class="btn btn-warning" onclick="previewInvoice()" style="flex: 1;">
                        üëÅÔ∏è √ñnizleme
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeInvoiceModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- B√ºt√ße Modal -->
    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>B√ºt√ße Planlamasƒ±</h2>
                <span class="close" onclick="closeBudgetModal()">&times;</span>
            </div>
            
            <form id="budgetForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>B√ºt√ße Adƒ± *</label>
                        <input type="text" id="budgetName" required placeholder="B√ºt√ße adƒ±nƒ± giriniz">
                    </div>

                    <div class="form-group">
                        <label>D√∂nem *</label>
                        <select id="budgetPeriod" required>
                            <option value="">Se√ßiniz...</option>
                            <option value="monthly">Aylƒ±k</option>
                            <option value="quarterly">√ú√ß Aylƒ±k</option>
                            <option value="yearly">Yƒ±llƒ±k</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Ba≈ülangƒ±√ß Tarihi</label>
                        <input type="date" id="budgetStartDate" required>
                    </div>

                    <div class="form-group">
                        <label>Biti≈ü Tarihi</label>
                        <input type="date" id="budgetEndDate" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Kategori</label>
                    <select id="budgetCategory">
                        <option value="marketing">Pazarlama</option>
                        <option value="operations">Operasyon</option>
                        <option value="hr">ƒ∞nsan Kaynaklarƒ±</option>
                        <option value="it">Bilgi ƒ∞≈ülem</option>
                        <option value="general">Genel Giderler</option>
                        <option value="other">Diƒüer</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>Planlanan Tutar *</label>
                        <input type="number" id="budgetAmount" required min="0" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>Uyarƒ± E≈üiƒüi (%)</label>
                        <input type="number" id="budgetThreshold" min="0" max="100" value="80" placeholder="80">
                    </div>
                </div>

                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <textarea id="budgetDescription" placeholder="B√ºt√ße a√ßƒ±klamasƒ±..." rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ‚úÖ B√ºt√ßeyi Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeBudgetModal()" style="flex: 1;">
                        ‚ùå ƒ∞ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bildirim -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Veri depolama
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
        let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
        let budgets = JSON.parse(localStorage.getItem('budgets')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let editingTransactionId = null;
        let editingAccountId = null;

        // Kategoriler
        const categories = {
            income: [
                'Satƒ±≈ü Gelirleri', 'Hizmet Gelirleri', 'Faiz Gelirleri', 'Kira Gelirleri', 
                'Yatƒ±rƒ±m Gelirleri', 'Diƒüer Gelirler'
            ],
            expense: [
                'Ofis Giderleri', 'Pazarlama', 'Personel Maa≈ülarƒ±', 'Kira', 'Elektrik/Su/Gaz',
                'ƒ∞leti≈üim', 'Ula≈üƒ±m', 'Yemek', 'Malzeme Alƒ±mƒ±', 'Vergi/Har√ß', 'Diƒüer Giderler'
            ],
            transfer: ['Hesap Transferi', 'Yatƒ±rƒ±m', 'Kredi √ñdemesi']
        };

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            loadTransactionsTable();
            loadAccountsList();
            updateStats();
            updateReports();
            
            // Form submit olaylarƒ±
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTransaction();
            });

            document.getElementById('accountForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveAccount();
            });

            document.getElementById('invoiceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInvoice();
            });

            document.getElementById('budgetForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBudget();
            });

            // Bug√ºn√ºn tarihini varsayƒ±lan olarak ayarla
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('budgetStartDate').value = new Date().toISOString().split('T')[0];
            
            // Ay filtresi i√ßin bu ayƒ± ayarla
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('monthFilter').value = currentMonth;
        });

        // Ba≈ülangƒ±√ß verilerini y√ºkle
        function initializeData() {
            if (accounts.length === 0) {
                accounts = [
                    {
                        id: 1,
                        name: 'Ana Kasa',
                        type: 'cash',
                        balance: 25000,
                        currency: 'TRY',
                        description: '≈ûirket ana kasasƒ±',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'ƒ∞≈ü Bankasƒ± Vadesiz',
                        type: 'bank',
                        balance: 150000,
                        currency: 'TRY',
                        description: 'ƒ∞≈ü bankasƒ± ticari hesap',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: 'Garanti BBVA USD',
                        type: 'bank',
                        balance: 5000,
                        currency: 'USD',
                        description: 'D√∂viz hesabƒ±',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        name: '≈ûirket Kredi Kartƒ±',
                        type: 'credit',
                        balance: -8500,
                        currency: 'TRY',
                        description: 'Kurumsal kredi kartƒ±',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('accounts', JSON.stringify(accounts));
            }

            if (transactions.length === 0) {
                transactions = [
                    {
                        id: 1,
                        date: '2025-07-01',
                        description: 'M√º≈üteri √∂demesi - ABC ≈ûirketi',
                        category: 'Satƒ±≈ü Gelirleri',
                        accountId: 2,
                        type: 'income',
                        amount: 45000,
                        currency: 'TRY',
                        notes: 'Fatura No: F-2025-001',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        date: '2025-06-30',
                        description: 'Ofis kirasƒ± - Temmuz',
                        category: 'Kira',
                        accountId: 2,
                        type: 'expense',
                        amount: 12000,
                        currency: 'TRY',
                        notes: 'Aylƒ±k ofis kirasƒ±',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        date: '2025-06-29',
                        description: 'Personel maa≈ülarƒ±',
                        category: 'Personel Maa≈ülarƒ±',
                        accountId: 2,
                        type: 'expense',
                        amount: 85000,
                        currency: 'TRY',
                        notes: 'Haziran ayƒ± maa≈ülarƒ±',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        date: '2025-06-28',
                        description: 'Pazarlama kampanyasƒ±',
                        category: 'Pazarlama',
                        accountId: 4,
                        type: 'expense',
                        amount: 8500,
                        currency: 'TRY',
                        notes: 'Google Ads ve sosyal medya',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 5,
                        date: '2025-06-27',
                        description: 'Hizmet geliri - XYZ Ltd.',
                        category: 'Hizmet Gelirleri',
                        accountId: 1,
                        type: 'income',
                        amount: 15000,
                        currency: 'TRY',
                        notes: 'Danƒ±≈ümanlƒ±k hizmeti',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }

            if (budgets.length === 0) {
                budgets = [
                    {
                        id: 1,
                        name: 'Pazarlama B√ºt√ßesi',
                        period: 'monthly',
                        startDate: '2025-07-01',
                        endDate: '2025-07-31',
                        category: 'marketing',
                        plannedAmount: 25000,
                        spentAmount: 8500,
                        threshold: 80,
                        description: 'Aylƒ±k pazarlama giderleri',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'Operasyonel Giderler',
                        period: 'monthly',
                        startDate: '2025-07-01',
                        endDate: '2025-07-31',
                        category: 'operations',
                        plannedAmount: 50000,
                        spentAmount: 12000,
                        threshold: 75,
                        description: 'Kira, elektrik, su vb.',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('budgets', JSON.stringify(budgets));
            }
        }

        // ƒ∞≈ülemler tablosunu y√ºkle
        function loadTransactionsTable() {
            const tbody = document.getElementById('transactionsTableBody');
            tbody.innerHTML = '';

            transactions.forEach((transaction, index) => {
                const account = accounts.find(a => a.id === transaction.accountId);
                const accountName = account ? account.name : 'Bilinmeyen Hesap';
                const typeInfo = getTransactionTypeInfo(transaction.type);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td><strong>${transaction.description}</strong></td>
                    <td>${transaction.category || '-'}</td>
                    <td>${accountName}</td>
                    <td><span class="transaction-type ${typeInfo.class}">${typeInfo.text}</span></td>
                    <td class="${transaction.type === 'income' ? 'positive' : transaction.type === 'expense' ? 'negative' : ''}">
                        <strong>${formatCurrency(transaction.amount, transaction.currency)}</strong>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-primary btn-small" onclick="viewTransaction(${index})" title="G√∂r√ºnt√ºle">üëÅÔ∏è</button>
                            <button class="btn btn-warning btn-small" onclick="editTransaction(${index})" title="D√ºzenle">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-small" onclick="deleteTransaction(${index})" title="Sil">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
            });
        }

        // Hesaplar listesini y√ºkle
        function loadAccountsList() {
            const container = document.getElementById('accountsList');
            container.innerHTML = '';

            if (accounts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d;">Hen√ºz hesap eklenmemi≈ü</p>';
                return;
            }

            accounts.forEach((account, index) => {
                const accountDiv = document.createElement('div');
                accountDiv.className = 'account-item';
                accountDiv.innerHTML = `
                    <div class="account-info">
                        <h4>${account.name}</h4>
                        <p>${getAccountTypeText(account.type)} - ${account.currency}</p>
                    </div>
                    <div>
                        <div class="account-balance ${account.balance >= 0 ? 'positive' : 'negative'}">
                            ${formatCurrency(account.balance, account.currency)}
                        </div>
                        <div style="display: flex; gap: 5px; margin-top: 5px;">
                            <button class="btn btn-warning btn-small" onclick="editAccount(${index})" title="D√ºzenle">‚úèÔ∏è</button>
                            <button class="btn btn-danger btn-small" onclick="deleteAccount(${index})" title="Sil">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                container.appendChild(accountDiv);
            });

            // Hesap se√ßeneklerini g√ºncelle
            loadAccountOptions();
        }

        // Hesap se√ßeneklerini y√ºkle
        function loadAccountOptions() {
            const selects = ['transactionAccount', 'targetAccount'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Hesap se√ßiniz...</option>';
                    
                    accounts.forEach(account => {
                        const option = document.createElement('option');
                        option.value = account.id;
                        option.textContent = `${account.name} (${formatCurrency(account.balance, account.currency)})`;
                        select.appendChild(option);
                    });
                }
            });

            // M√º≈üteri se√ßeneklerini y√ºkle
            const customerSelect = document.getElementById('invoiceCustomer');
            if (customerSelect && customers.length > 0) {
                customerSelect.innerHTML = '<option value="">M√º≈üteri se√ßiniz...</option>';
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    customerSelect.appendChild(option);
                });
            }
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            const totalBalance = accounts.reduce((sum, account) => {
                if (account.currency === 'TRY') {
                    return sum + account.balance;
                } else if (account.currency === 'USD') {
                    return sum + (account.balance * 32); // Basit kur hesabƒ±
                } else if (account.currency === 'EUR') {
                    return sum + (account.balance * 35); // Basit kur hesabƒ±
                }
                return sum;
            }, 0);

            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            const netProfit = totalIncome - totalExpense;

            // Bu ayƒ±n i≈ülemleri
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyRevenue = transactions
                .filter(t => t.date.startsWith(currentMonth) && t.type === 'income')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            document.getElementById('totalBalance').textContent = formatCurrency(totalBalance, 'TRY');
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome, 'TRY');
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense, 'TRY');
            document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue, 'TRY');
            
            const netProfitElement = document.getElementById('netProfit');
            netProfitElement.textContent = formatCurrency(netProfit, 'TRY');
            netProfitElement.className = `stat-number ${netProfit >= 0 ? 'positive' : 'negative'}`;
        }

        // Raporlarƒ± g√ºncelle
        function updateReports() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            const monthlyIncome = transactions
                .filter(t => t.date.startsWith(currentMonth) && t.type === 'income')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            const monthlyExpense = transactions
                .filter(t => t.date.startsWith(currentMonth) && t.type === 'expense')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            const netCashflow = monthlyIncome - monthlyExpense;

            document.getElementById('monthlyIncome').textContent = formatCurrency(monthlyIncome, 'TRY');
            document.getElementById('monthlyExpense').textContent = formatCurrency(monthlyExpense, 'TRY');
            
            const netCashflowElement = document.getElementById('netCashflow');
            netCashflowElement.textContent = formatCurrency(netCashflow, 'TRY');
            netCashflowElement.className = netCashflow >= 0 ? 'positive' : 'negative';

            // Kar/Zarar detaylarƒ±
            const grossProfit = transactions
                .filter(t => t.type === 'income' && t.category === 'Satƒ±≈ü Gelirleri')
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            const operationalExpenses = transactions
                .filter(t => t.type === 'expense' && ['Kira', 'Personel Maa≈ülarƒ±', 'Ofis Giderleri'].includes(t.category))
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * (t.currency === 'USD' ? 32 : 35)), 0);

            document.getElementById('grossProfit').textContent = formatCurrency(grossProfit, 'TRY');
            document.getElementById('operationalExpenses').textContent = formatCurrency(operationalExpenses, 'TRY');
            document.getElementById('netProfitDetail').textContent = formatCurrency(grossProfit - operationalExpenses, 'TRY');

            // B√ºt√ße durumunu g√ºncelle
            updateBudgetDisplay();
        }

        // B√ºt√ße g√∂r√ºn√ºm√ºn√º g√ºncelle
        function updateBudgetDisplay() {
            const container = document.getElementById('budgetItems');
            container.innerHTML = '';

            budgets.forEach(budget => {
                const percentage = budget.plannedAmount > 0 ? (budget.spentAmount / budget.plannedAmount) * 100 : 0;
                const isOverBudget = percentage > 100;
                const isWarning = percentage > budget.threshold;
                
                const budgetDiv = document.createElement('div');
                budgetDiv.className = 'budget-item';
                budgetDiv.innerHTML = `
                    <div>
                        <strong>${budget.name}</strong>
                        <div style="font-size: 0.9rem; color: #7f8c8d;">
                            ${formatCurrency(budget.spentAmount, 'TRY')} / ${formatCurrency(budget.plannedAmount, 'TRY')}
                        </div>
                        <div class="budget-progress">
                            <div class="budget-progress-bar" style="width: ${Math.min(percentage, 100)}%; background: ${isOverBudget ? '#e74c3c' : isWarning ? '#f39c12' : '#27ae60'};"></div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold; color: ${isOverBudget ? '#e74c3c' : isWarning ? '#f39c12' : '#27ae60'};">
                            %${percentage.toFixed(1)}
                        </div>
                    </div>
                `;
                container.appendChild(budgetDiv);
            });
        }

        // ƒ∞≈ülem modal a√ßma
        function openTransactionModal() {
            editingTransactionId = null;
            document.getElementById('transactionModalTitle').textContent = 'Yeni Mali ƒ∞≈ülem';
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('transactionCurrency').value = 'TRY';
            document.getElementById('transferSection').style.display = 'none';
            updateTransactionForm();
            document.getElementById('transactionModal').style.display = 'block';
        }

        // ƒ∞≈ülem modal kapatma
        function closeTransactionModal() {
            document.getElementById('transactionModal').style.display = 'none';
            editingTransactionId = null;
        }

        // Hesap modal a√ßma
        function openAccountModal() {
            editingAccountId = null;
            document.getElementById('accountModalTitle').textContent = 'Yeni Hesap Ekle';
            document.getElementById('accountForm').reset();
            document.getElementById('accountCurrency').value = 'TRY';
            document.getElementById('accountModal').style.display = 'block';
        }

        // Hesap modal kapatma
        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
            editingAccountId = null;
        }

        // Fatura modal a√ßma
        function openInvoiceModal() {
            document.getElementById('invoiceNumber').value = generateInvoiceNumber();
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceItems').innerHTML = '';
            addInvoiceItem();
            document.getElementById('invoiceModal').style.display = 'block';
        }

        // Fatura modal kapatma
        function closeInvoiceModal() {
            document.getElementById('invoiceModal').style.display = 'none';
        }

                // B√ºt√ße modal a√ßma
        function openBudgetModal() {
            document.getElementById('budgetForm').reset();
            document.getElementById('budgetStartDate').value = new Date().toISOString().split('T')[0];
            
            // Biti≈ü tarihini bir ay sonra ayarla
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + 1);
            document.getElementById('budgetEndDate').value = endDate.toISOString().split('T')[0];
            
            document.getElementById('budgetModal').style.display = 'block';
        }

        // B√ºt√ße modal kapatma
        function closeBudgetModal() {
            document.getElementById('budgetModal').style.display = 'none';
        }

        // ƒ∞≈ülem formu g√ºncelleme
        function updateTransactionForm() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('transactionCategory');
            const transferSection = document.getElementById('transferSection');
            
            // Kategori se√ßeneklerini g√ºncelle
            categorySelect.innerHTML = '<option value="">Se√ßiniz...</option>';
            if (categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }

            // Transfer b√∂l√ºm√ºn√º g√∂ster/gizle
            transferSection.style.display = type === 'transfer' ? 'block' : 'none';
        }

        // Fatura numarasƒ± olu≈ütur
        function generateInvoiceNumber() {
            const year = new Date().getFullYear();
            const invoiceCount = invoices.length + 1;
            return `F-${year}-${invoiceCount.toString().padStart(3, '0')}`;
        }

        // Fatura kalemi ekle
        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'invoice-item-row';
            itemDiv.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 10px; margin-bottom: 10px; align-items: center;';
            
            itemDiv.innerHTML = `
                <input type="text" placeholder="√úr√ºn/Hizmet a√ßƒ±klamasƒ±" class="item-description" onchange="calculateInvoiceTotal()">
                <input type="number" placeholder="Miktar" min="1" class="item-quantity" value="1" onchange="calculateInvoiceTotal()">
                <input type="number" placeholder="Birim fiyat" min="0" step="0.01" class="item-price" onchange="calculateInvoiceTotal()">
                <input type="number" placeholder="Toplam" class="item-total" readonly>
                <button type="button" class="btn btn-danger btn-small" onclick="removeInvoiceItem(this)">‚ùå</button>
            `;
            container.appendChild(itemDiv);
            calculateInvoiceTotal();
        }

        // Fatura kalemi sil
        function removeInvoiceItem(button) {
            if (document.querySelectorAll('.invoice-item-row').length > 1) {
                button.parentElement.remove();
                calculateInvoiceTotal();
            } else {
                showNotification('En az bir kalem bulunmalƒ±dƒ±r!', 'warning');
            }
        }

        // Fatura toplamƒ±nƒ± hesapla
        function calculateInvoiceTotal() {
            const itemRows = document.querySelectorAll('.invoice-item-row');
            let subtotal = 0;

            itemRows.forEach(row => {
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const itemTotal = quantity * price;
                
                row.querySelector('.item-total').value = itemTotal.toFixed(2);
                subtotal += itemTotal;
            });

            const vatAmount = subtotal * 0.18; // %18 KDV
            const total = subtotal + vatAmount;

            document.getElementById('invoiceSubtotal').textContent = formatCurrency(subtotal, 'TRY');
            document.getElementById('invoiceVat').textContent = formatCurrency(vatAmount, 'TRY');
            document.getElementById('invoiceTotal').textContent = formatCurrency(total, 'TRY');
        }

        // ƒ∞≈ülem kaydet
        function saveTransaction() {
            const transactionData = {
                date: document.getElementById('transactionDate').value,
                description: document.getElementById('transactionDescription').value,
                category: document.getElementById('transactionCategory').value,
                accountId: parseInt(document.getElementById('transactionAccount').value),
                type: document.getElementById('transactionType').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                currency: document.getElementById('transactionCurrency').value,
                notes: document.getElementById('transactionNotes').value,
                createdAt: new Date().toISOString()
            };

            // Transfer i≈ülemi i√ßin hedef hesap
            if (transactionData.type === 'transfer') {
                const targetAccountId = parseInt(document.getElementById('targetAccount').value);
                if (!targetAccountId || targetAccountId === transactionData.accountId) {
                    showNotification('L√ºtfen farklƒ± bir hedef hesap se√ßiniz!', 'error');
                    return;
                }
                transactionData.targetAccountId = targetAccountId;
            }

            if (!transactionData.accountId || !transactionData.amount || transactionData.amount <= 0) {
                showNotification('L√ºtfen t√ºm gerekli alanlarƒ± doldurunuz!', 'error');
                return;
            }

            // Hesap bakiyelerini g√ºncelle
            updateAccountBalances(transactionData);

            if (editingTransactionId !== null) {
                transactionData.id = transactions[editingTransactionId].id;
                transactions[editingTransactionId] = transactionData;
                showNotification('ƒ∞≈ülem ba≈üarƒ±yla g√ºncellendi!', 'success');
            } else {
                transactionData.id = Date.now();
                transactions.push(transactionData);
                showNotification('ƒ∞≈ülem ba≈üarƒ±yla kaydedildi!', 'success');
            }

            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('accounts', JSON.stringify(accounts));
            
            loadTransactionsTable();
            loadAccountsList();
            updateStats();
            updateReports();
            closeTransactionModal();
        }

        // Hesap kaydet
        function saveAccount() {
            const accountData = {
                name: document.getElementById('accountName').value,
                type: document.getElementById('accountType').value,
                balance: parseFloat(document.getElementById('initialBalance').value) || 0,
                currency: document.getElementById('accountCurrency').value,
                description: document.getElementById('accountDescription').value,
                createdAt: new Date().toISOString()
            };

            if (!accountData.name || !accountData.type) {
                showNotification('L√ºtfen hesap adƒ± ve t√ºr√ºn√º giriniz!', 'error');
                return;
            }

            if (editingAccountId !== null) {
                accountData.id = accounts[editingAccountId].id;
                accounts[editingAccountId] = accountData;
                showNotification('Hesap ba≈üarƒ±yla g√ºncellendi!', 'success');
            } else {
                accountData.id = Date.now();
                accounts.push(accountData);
                showNotification('Hesap ba≈üarƒ±yla eklendi!', 'success');
            }

            localStorage.setItem('accounts', JSON.stringify(accounts));
            loadAccountsList();
            updateStats();
            closeAccountModal();
        }

        // Fatura kaydet
        function saveInvoice() {
            const invoiceData = {
                invoiceNumber: document.getElementById('invoiceNumber').value,
                date: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('dueDate').value,
                customerId: parseInt(document.getElementById('invoiceCustomer').value),
                type: document.getElementById('invoiceType').value,
                notes: document.getElementById('invoiceNotes').value,
                createdAt: new Date().toISOString()
            };

            // Fatura kalemlerini topla
            const itemRows = document.querySelectorAll('.invoice-item-row');
            const items = [];
            let subtotal = 0;

            itemRows.forEach(row => {
                const description = row.querySelector('.item-description').value;
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const total = quantity * price;

                if (description && quantity > 0 && price > 0) {
                    items.push({
                        description,
                        quantity,
                        unitPrice: price,
                        total
                    });
                    subtotal += total;
                }
            });

            if (items.length === 0) {
                showNotification('En az bir fatura kalemi eklemelisiniz!', 'error');
                return;
            }

            if (!invoiceData.customerId) {
                showNotification('L√ºtfen bir m√º≈üteri se√ßiniz!', 'error');
                return;
            }

            const vatAmount = subtotal * 0.18;
            const total = subtotal + vatAmount;

            invoiceData.items = items;
            invoiceData.subtotal = subtotal;
            invoiceData.vatAmount = vatAmount;
            invoiceData.total = total;
            invoiceData.id = Date.now();

            invoices.push(invoiceData);
            localStorage.setItem('invoices', JSON.stringify(invoices));

            // Fatura tutarƒ±nƒ± gelir olarak ekle (satƒ±≈ü faturasƒ± ise)
            if (invoiceData.type === 'sales') {
                const incomeTransaction = {
                    id: Date.now() + 1,
                    date: invoiceData.date,
                    description: `Fatura Geliri - ${invoiceData.invoiceNumber}`,
                    category: 'Satƒ±≈ü Gelirleri',
                    accountId: accounts.find(a => a.type === 'bank')?.id || accounts[0].id,
                    type: 'income',
                    amount: total,
                    currency: 'TRY',
                    notes: `Fatura No: ${invoiceData.invoiceNumber}`,
                    createdAt: new Date().toISOString()
                };

                transactions.push(incomeTransaction);
                localStorage.setItem('transactions', JSON.stringify(transactions));

                // Hesap bakiyesini g√ºncelle
                const account = accounts.find(a => a.id === incomeTransaction.accountId);
                if (account) {
                    account.balance += total;
                    localStorage.setItem('accounts', JSON.stringify(accounts));
                }
            }

            showNotification('Fatura ba≈üarƒ±yla olu≈üturuldu!', 'success');
            loadTransactionsTable();
            loadAccountsList();
            updateStats();
            updateReports();
            closeInvoiceModal();
        }

        // B√ºt√ße kaydet
        function saveBudget() {
            const budgetData = {
                name: document.getElementById('budgetName').value,
                period: document.getElementById('budgetPeriod').value,
                startDate: document.getElementById('budgetStartDate').value,
                endDate: document.getElementById('budgetEndDate').value,
                category: document.getElementById('budgetCategory').value,
                plannedAmount: parseFloat(document.getElementById('budgetAmount').value),
                spentAmount: 0,
                threshold: parseInt(document.getElementById('budgetThreshold').value),
                description: document.getElementById('budgetDescription').value,
                createdAt: new Date().toISOString()
            };

            if (!budgetData.name || !budgetData.period || !budgetData.plannedAmount) {
                showNotification('L√ºtfen t√ºm gerekli alanlarƒ± doldurunuz!', 'error');
                return;
            }

            // Mevcut harcamalarƒ± hesapla
            const categoryExpenses = transactions
                .filter(t => t.type === 'expense' && 
                           t.date >= budgetData.startDate && 
                           t.date <= budgetData.endDate &&
                           t.category && t.category.toLowerCase().includes(budgetData.category.toLowerCase()))
                .reduce((sum, t) => sum + (t.currency === 'TRY' ? t.amount : t.amount * 32), 0);

            budgetData.spentAmount = categoryExpenses;
            budgetData.id = Date.now();

            budgets.push(budgetData);
            localStorage.setItem('budgets', JSON.stringify(budgets));

            showNotification('B√ºt√ße ba≈üarƒ±yla olu≈üturuldu!', 'success');
            updateReports();
            closeBudgetModal();
        }

        // Hesap bakiyelerini g√ºncelle
        function updateAccountBalances(transaction) {
            const account = accounts.find(a => a.id === transaction.accountId);
            
            if (account) {
                let amount = transaction.amount;
                
                // D√∂viz √ßevirimi (basit)
                if (account.currency !== transaction.currency) {
                    if (transaction.currency === 'USD' && account.currency === 'TRY') {
                        amount *= 32;
                    } else if (transaction.currency === 'EUR' && account.currency === 'TRY') {
                        amount *= 35;
                    } else if (transaction.currency === 'TRY' && account.currency === 'USD') {
                        amount /= 32;
                    } else if (transaction.currency === 'TRY' && account.currency === 'EUR') {
                        amount /= 35;
                    }
                }

                if (transaction.type === 'income') {
                    account.balance += amount;
                } else if (transaction.type === 'expense') {
                    account.balance -= amount;
                } else if (transaction.type === 'transfer') {
                    account.balance -= amount;
                    
                    // Hedef hesabƒ± g√ºncelle
                    const targetAccount = accounts.find(a => a.id === transaction.targetAccountId);
                    if (targetAccount) {
                        let targetAmount = amount;
                        
                        // Hedef hesap i√ßin d√∂viz √ßevirimi
                        if (account.currency !== targetAccount.currency) {
                            if (account.currency === 'USD' && targetAccount.currency === 'TRY') {
                                targetAmount *= 32;
                            } else if (account.currency === 'EUR' && targetAccount.currency === 'TRY') {
                                targetAmount *= 35;
                            } else if (account.currency === 'TRY' && targetAccount.currency === 'USD') {
                                targetAmount /= 32;
                            } else if (account.currency === 'TRY' && targetAccount.currency === 'EUR') {
                                targetAmount /= 35;
                            }
                        }
                        
                        targetAccount.balance += targetAmount;
                    }
                }
            }
        }

        // ƒ∞≈ülem d√ºzenle
        function editTransaction(index) {
            editingTransactionId = index;
            const transaction = transactions[index];
            
            document.getElementById('transactionModalTitle').textContent = 'ƒ∞≈ülemi D√ºzenle';
            document.getElementById('transactionType').value = transaction.type;
            document.getElementById('transactionDate').value = transaction.date;
            document.getElementById('transactionDescription').value = transaction.description;
            document.getElementById('transactionAccount').value = transaction.accountId;
            document.getElementById('transactionAmount').value = transaction.amount;
            document.getElementById('transactionCurrency').value = transaction.currency;
            document.getElementById('transactionNotes').value = transaction.notes || '';
            
            updateTransactionForm();
            document.getElementById('transactionCategory').value = transaction.category || '';
            
            if (transaction.targetAccountId) {
                document.getElementById('targetAccount').value = transaction.targetAccountId;
            }
            
            document.getElementById('transactionModal').style.display = 'block';
        }

        // Hesap d√ºzenle
        function editAccount(index) {
            editingAccountId = index;
            const account = accounts[index];
            
            document.getElementById('accountModalTitle').textContent = 'Hesabƒ± D√ºzenle';
            document.getElementById('accountName').value = account.name;
            document.getElementById('accountType').value = account.type;
            document.getElementById('initialBalance').value = account.balance;
            document.getElementById('accountCurrency').value = account.currency;
            document.getElementById('accountDescription').value = account.description || '';
            
            document.getElementById('accountModal').style.display = 'block';
        }

        // ƒ∞≈ülem g√∂r√ºnt√ºle
        function viewTransaction(index) {
            const transaction = transactions[index];
            const account = accounts.find(a => a.id === transaction.accountId);
            const accountName = account ? account.name : 'Bilinmeyen Hesap';
            const typeInfo = getTransactionTypeInfo(transaction.type);
            
            let targetAccountInfo = '';
            if (transaction.targetAccountId) {
                const targetAccount = accounts.find(a => a.id === transaction.targetAccountId);
                targetAccountInfo = `<p><strong>Hedef Hesap:</strong> ${targetAccount ? targetAccount.name : 'Bilinmeyen'}</p>`;
            }
            
            const content = `
                <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px;">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">ƒ∞≈ülem Detaylarƒ±</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <p><strong>Tarih:</strong> ${formatDate(transaction.date)}</p>
                            <p><strong>A√ßƒ±klama:</strong> ${transaction.description}</p>
                            <p><strong>Kategori:</strong> ${transaction.category || '-'}</p>
                            <p><strong>Hesap:</strong> ${accountName}</p>
                            ${targetAccountInfo}
                        </div>
                        <div>
                            <p><strong>ƒ∞≈ülem T√ºr√º:</strong> <span class="transaction-type ${typeInfo.class}">${typeInfo.text}</span></p>
                            <p><strong>Tutar:</strong> <span style="font-size: 1.3rem; font-weight: bold; color: ${transaction.type === 'income' ? '#27ae60' : transaction.type === 'expense' ? '#e74c3c' : '#3498db'};">${formatCurrency(transaction.amount, transaction.currency)}</span></p>
                            <p><strong>Para Birimi:</strong> ${transaction.currency}</p>
                        </div>
                    </div>

                    ${transaction.notes ? `<div style="margin-top: 15px; padding: 15px; background: rgba(52, 152, 219, 0.1); border-radius: 8px;"><strong>Notlar:</strong><br>${transaction.notes}</div>` : ''}
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="closeViewModal()">Kapat</button>
                    </div>
                </div>
            `;
            
            showModal('ƒ∞≈ülem Detaylarƒ±', content);
        }

        // ƒ∞≈ülem sil
        function deleteTransaction(index) {
            const transaction = transactions[index];
            if (confirm(`"${transaction.description}" i≈ülemini silmek istediƒüinizden emin misiniz?`)) {
                // Hesap bakiyesini geri al
                const account = accounts.find(a => a.id === transaction.accountId);
                if (account) {
                    let amount = transaction.amount;
                    
                    if (transaction.type === 'income') {
                        account.balance -= amount;
                    } else if (transaction.type === 'expense') {
                        account.balance += amount;
                    } else if (transaction.type === 'transfer') {
                        account.balance += amount;
                        
                        const targetAccount = accounts.find(a => a.id === transaction.targetAccountId);
                        if (targetAccount) {
                            targetAccount.balance -= amount;
                        }
                    }
                }
                
                transactions.splice(index, 1);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('accounts', JSON.stringify(accounts));
                
                loadTransactionsTable();
                loadAccountsList();
                updateStats();
                updateReports();
                showNotification('ƒ∞≈ülem ba≈üarƒ±yla silindi!', 'success');
            }
        }

        // Hesap sil
        function deleteAccount(index) {
            const account = accounts[index];
            
            // Bu hesaba ait i≈ülem var mƒ± kontrol et
            const hasTransactions = transactions.some(t => t.accountId === account.id || t.targetAccountId === account.id);
            
            if (hasTransactions) {
                showNotification('Bu hesaba ait i≈ülemler bulunduƒüu i√ßin silinemez!', 'error');
                return;
            }
            
            if (confirm(`"${account.name}" hesabƒ±nƒ± silmek istediƒüinizden emin misiniz?`)) {
                accounts.splice(index, 1);
                localStorage.setItem('accounts', JSON.stringify(accounts));
                loadAccountsList();
                updateStats();
                showNotification('Hesap ba≈üarƒ±yla silindi!', 'success');
            }
        }

        // ƒ∞≈ülem arama
        function searchTransactions() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#transactionsTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ƒ∞≈ülem filtreleme
        function filterTransactions() {
            const typeFilter = document.getElementById('typeFilter').value;
            const monthFilter = document.getElementById('monthFilter').value;
            const rows = document.querySelectorAll('#transactionsTableBody tr');
            
            rows.forEach((row, index) => {
                const transaction = transactions[index];
                let showRow = true;
                
                if (typeFilter && transaction.type !== typeFilter) {
                    showRow = false;
                }
                
                if (monthFilter && !transaction.date.startsWith(monthFilter)) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Fatura √∂nizleme
        function previewInvoice() {
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            const customerId = document.getElementById('invoiceCustomer').value;
            const customer = customers.find(c => c.id == customerId);
            
            if (!customer) {
                showNotification('L√ºtfen bir m√º≈üteri se√ßiniz!', 'error');
                return;
            }

            const itemRows = document.querySelectorAll('.invoice-item-row');
            let itemsHtml = '';
            let subtotal = 0;

            itemRows.forEach(row => {
                const description = row.querySelector('.item-description').value;
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const total = quantity * price;

                if (description && quantity > 0 && price > 0) {
                    itemsHtml += `
                        <tr>
                            <td>${description}</td>
                            <td style="text-align: center;">${quantity}</td>
                            <td style="text-align: right;">${formatCurrency(price, 'TRY')}</td>
                            <td style="text-align: right;"><strong>${formatCurrency(total, 'TRY')}</strong></td>
                        </tr>
                    `;
                    subtotal += total;
                }
            });

            const vatAmount = subtotal * 0.18;
            const total = subtotal + vatAmount;

            const content = `
                <div class="invoice-container">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50;">FATURA</h1>
                        <p style="font-size: 1.2rem; color: #7f8c8d;">${invoiceNumber}</p>
                    </div>
                    
                    <div class="invoice-header">
                        <div>
                            <h3>≈ûirket Bilgileri</h3>
                            <p><strong>ABC ≈ûirketi Ltd. ≈ûti.</strong></p>
                            <p>Maslak Mahallesi, ƒ∞≈ü Merkezi No:123</p>
                            <p>Sarƒ±yer/ƒ∞stanbul</p>
                            <p>Tel: 0212 555 00 00</p>
                            <p>Vergi No: 1234567890</p>
                        </div>
                        <div>
                            <h3>M√º≈üteri Bilgileri</h3>
                            <p><strong>${customer.name}</strong></p>
                            <p>${customer.address || 'Adres bilgisi yok'}</p>
                            <p>Tel: ${customer.phone || 'Telefon bilgisi yok'}</p>
                            <p>Vergi No: ${customer.taxNumber || 'Vergi no bilgisi yok'}</p>
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <p><strong>Fatura Tarihi:</strong> ${formatDate(invoiceDate)}</p>
                        <p><strong>Vade Tarihi:</strong> ${document.getElementById('dueDate').value ? formatDate(document.getElementById('dueDate').value) : 'Belirtilmemi≈ü'}</p>
                    </div>

                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>A√ßƒ±klama</th>
                                <th style="text-align: center;">Miktar</th>
                                <th style="text-align: right;">Birim Fiyat</th>
                                <th style="text-align: right;">Toplam</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>

                    <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                        <div style="width: 300px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #ddd;">
                                <span>Ara Toplam:</span>
                                <span>${formatCurrency(subtotal, 'TRY')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #ddd;">
                                <span>KDV (%18):</span>
                                <span>${formatCurrency(vatAmount, 'TRY')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; font-weight: bold; font-size: 1.2rem; border-top: 2px solid #2c3e50;">
                                <span>TOPLAM:</span>
                                <span>${formatCurrency(total, 'TRY')}</span>
                            </div>
                        </div>
                    </div>

                    ${document.getElementById('invoiceNotes').value ? `<div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;"><strong>Notlar:</strong><br>${document.getElementById('invoiceNotes').value}</div>` : ''}
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="printInvoice()" style="margin-right: 10px;">üñ®Ô∏è Yazdƒ±r</button>
                        <button class="btn btn-secondary" onclick="closeViewModal()">Kapat</button>
                    </div>
                </div>
            `;
            
            showModal('Fatura √ñnizleme', content);
        }

        // Fatura yazdƒ±r
        function printInvoice() {
            window.print();
        }

        // Finansal rapor dƒ±≈üa aktar
        function exportFinancialReport() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            let csvContent = 'Tarih,A√ßƒ±klama,Kategori,Hesap,T√ºr,Tutar,Para Birimi,Notlar\n';
            
            transactions.forEach(transaction => {
                const account = accounts.find(a => a.id === transaction.accountId);
                const accountName = account ? account.name : 'Bilinmeyen';
                const typeText = getTransactionTypeInfo(transaction.type).text;
                
                csvContent += `"${transaction.date}","${transaction.description}","${transaction.category || ''}","${accountName}","${typeText}","${transaction.amount}","${transaction.currency}","${transaction.notes || ''}"\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `finansal_rapor_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Finansal rapor ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±!', 'success');
        }

                // Tab g√∂sterme
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Yardƒ±mcƒ± fonksiyonlar
        function getTransactionTypeInfo(type) {
            const types = {
                'income': { class: 'type-income', text: 'Gelir' },
                'expense': { class: 'type-expense', text: 'Gider' },
                'transfer': { class: 'type-transfer', text: 'Transfer' }
            };
            return types[type] || { class: 'type-income', text: 'Bilinmeyen' };
        }

        function getAccountTypeText(type) {
            const types = {
                'cash': 'Nakit',
                'bank': 'Banka Hesabƒ±',
                'credit': 'Kredi Kartƒ±',
                'investment': 'Yatƒ±rƒ±m',
                'other': 'Diƒüer'
            };
            return types[type] || 'Bilinmeyen';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        function formatCurrency(amount, currency = 'TRY') {
            const symbols = {
                'TRY': '‚Ç∫',
                'USD': '$',
                'EUR': '‚Ç¨'
            };
            
            return `${symbols[currency] || '‚Ç∫'}${amount.toLocaleString('tr-TR', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            })}`;
        }

        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>${title}</h2>
                        <span class="close" onclick="closeViewModal()">&times;</span>
                    </div>
                    ${content}
                </div>
            `;
            document.body.appendChild(modal);
            window.currentViewModal = modal;
        }

        function closeViewModal() {
            if (window.currentViewModal) {
                document.body.removeChild(window.currentViewModal);
                window.currentViewModal = null;
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            switch(type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'warning':
                    notification.style.background = '#f39c12';
                    break;
                default:
                    notification.style.background = '#3498db';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapatma
        window.onclick = function(event) {
            const transactionModal = document.getElementById('transactionModal');
            const accountModal = document.getElementById('accountModal');
            const invoiceModal = document.getElementById('invoiceModal');
            const budgetModal = document.getElementById('budgetModal');
            
            if (event.target == transactionModal) {
                closeTransactionModal();
            }
            if (event.target == accountModal) {
                closeAccountModal();
            }
            if (event.target == invoiceModal) {
                closeInvoiceModal();
            }
            if (event.target == budgetModal) {
                closeBudgetModal();
            }
        }

        // Klavye kƒ±sayollarƒ±
        document.addEventListener('keydown', function(e) {
            // Ctrl + N: Yeni i≈ülem
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                openTransactionModal();
            }
            
            // Ctrl + H: Yeni hesap
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                openAccountModal();
            }
            
            // Ctrl + F: Yeni fatura
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                openInvoiceModal();
            }
            
            // Ctrl + B: Yeni b√ºt√ße
            if (e.ctrlKey && e.key === 'b') {
                e.preventDefault();
                openBudgetModal();
            }
            
            // ESC: Modal kapat
            if (e.key === 'Escape') {
                closeTransactionModal();
                closeAccountModal();
                closeInvoiceModal();
                closeBudgetModal();
                closeViewModal();
            }
        });

        // Otomatik kaydetme (her 30 saniyede bir)
        setInterval(function() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('invoices', JSON.stringify(invoices));
            localStorage.setItem('budgets', JSON.stringify(budgets));
        }, 30000);

        // Sayfa kapatƒ±lmadan √∂nce uyarƒ±
        window.addEventListener('beforeunload', function(e) {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('invoices', JSON.stringify(invoices));
            localStorage.setItem('budgets', JSON.stringify(budgets));
        });

        // B√ºt√ße uyarƒ±larƒ± kontrol et
        function checkBudgetAlerts() {
            budgets.forEach(budget => {
                const percentage = budget.plannedAmount > 0 ? (budget.spentAmount / budget.plannedAmount) * 100 : 0;
                
                if (percentage >= 100) {
                    showNotification(`‚ö†Ô∏è "${budget.name}" b√ºt√ßesi a≈üƒ±ldƒ±! (%${percentage.toFixed(1)})`, 'error');
                } else if (percentage >= budget.threshold) {
                    showNotification(`‚ö†Ô∏è "${budget.name}" b√ºt√ßesi e≈üiƒüe yakla≈ütƒ±! (%${percentage.toFixed(1)})`, 'warning');
                }
            });
        }

        // Sayfa y√ºklendiƒüinde b√ºt√ße uyarƒ±larƒ±nƒ± kontrol et
        setTimeout(checkBudgetAlerts, 2000);

        // Geli≈ümi≈ü arama fonksiyonu
        function advancedSearch() {
            const searchModal = `
                <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Geli≈ümi≈ü Arama</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Tarihi</label>
                            <input type="date" id="searchStartDate">
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü Tarihi</label>
                            <input type="date" id="searchEndDate">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Minimum Tutar</label>
                            <input type="number" id="searchMinAmount" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Maksimum Tutar</label>
                            <input type="number" id="searchMaxAmount" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>ƒ∞≈ülem T√ºr√º</label>
                            <select id="searchType">
                                <option value="">T√ºm√º</option>
                                <option value="income">Gelir</option>
                                <option value="expense">Gider</option>
                                <option value="transfer">Transfer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Hesap</label>
                            <select id="searchAccount">
                                <option value="">T√ºm Hesaplar</option>
                                ${accounts.map(account => `<option value="${account.id}">${account.name}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>A√ßƒ±klama/Not ƒ∞√ßinde Ara</label>
                        <input type="text" id="searchKeyword" placeholder="Anahtar kelime...">
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button class="btn btn-primary" onclick="performAdvancedSearch()" style="flex: 1;">üîç Ara</button>
                        <button class="btn btn-secondary" onclick="clearAdvancedSearch()" style="flex: 1;">üóëÔ∏è Temizle</button>
                        <button class="btn btn-secondary" onclick="closeViewModal()">‚ùå Kapat</button>
                    </div>
                </div>
            `;
            
            showModal('Geli≈ümi≈ü Arama', searchModal);
        }

        // Geli≈ümi≈ü arama ger√ßekle≈ütir
        function performAdvancedSearch() {
            const startDate = document.getElementById('searchStartDate').value;
            const endDate = document.getElementById('searchEndDate').value;
            const minAmount = parseFloat(document.getElementById('searchMinAmount').value) || 0;
            const maxAmount = parseFloat(document.getElementById('searchMaxAmount').value) || Infinity;
            const type = document.getElementById('searchType').value;
            const accountId = document.getElementById('searchAccount').value;
            const keyword = document.getElementById('searchKeyword').value.toLowerCase();
            
            const rows = document.querySelectorAll('#transactionsTableBody tr');
            let visibleCount = 0;
            
            rows.forEach((row, index) => {
                const transaction = transactions[index];
                let show = true;
                
                // Tarih kontrol√º
                if (startDate && transaction.date < startDate) show = false;
                if (endDate && transaction.date > endDate) show = false;
                
                // Tutar kontrol√º
                if (transaction.amount < minAmount || transaction.amount > maxAmount) show = false;
                
                // T√ºr kontrol√º
                if (type && transaction.type !== type) show = false;
                
                // Hesap kontrol√º
                if (accountId && transaction.accountId != accountId) show = false;
                
                // Anahtar kelime kontrol√º
                if (keyword) {
                    const searchText = `${transaction.description} ${transaction.notes || ''}`.toLowerCase();
                    if (!searchText.includes(keyword)) show = false;
                }
                
                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            
            showNotification(`${visibleCount} i≈ülem bulundu.`, 'success');
            closeViewModal();
        }

        // Geli≈ümi≈ü aramayƒ± temizle
        function clearAdvancedSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('monthFilter').value = new Date().toISOString().slice(0, 7);
            
            const rows = document.querySelectorAll('#transactionsTableBody tr');
            rows.forEach(row => {
                row.style.display = '';
            });
            
            closeViewModal();
            showNotification('Arama filtreleri temizlendi.', 'success');
        }

        // Hƒ±zlƒ± i≈ülem ekleme fonksiyonlarƒ±
        function quickIncomeTransaction() {
            openTransactionModal();
            document.getElementById('transactionType').value = 'income';
            updateTransactionForm();
            document.getElementById('transactionCategory').value = 'Satƒ±≈ü Gelirleri';
        }

        function quickExpenseTransaction() {
            openTransactionModal();
            document.getElementById('transactionType').value = 'expense';
            updateTransactionForm();
            document.getElementById('transactionCategory').value = 'Ofis Giderleri';
        }

        function quickTransferTransaction() {
            openTransactionModal();
            document.getElementById('transactionType').value = 'transfer';
            updateTransactionForm();
        }

        // Toplu i≈ülemler
        function bulkDeleteTransactions() {
            if (confirm('Se√ßili i≈ülemleri silmek istediƒüinizden emin misiniz?')) {
                // Bu √∂zellik i√ßin checkbox'lar eklenebilir
                showNotification('Toplu silme √∂zelliƒüi geli≈ütirme a≈üamasƒ±nda!', 'info');
            }
        }

        // Veri yedekleme
        function backupData() {
            const backupData = {
                transactions,
                accounts,
                invoices,
                budgets,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `finans_yedek_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Veriler ba≈üarƒ±yla yedeklendi!', 'success');
        }

        // Veri geri y√ºkleme
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const backupData = JSON.parse(e.target.result);
                            
                            if (confirm('Mevcut veriler silinecek ve yedek veriler y√ºklenecek. Onaylƒ±yor musunuz?')) {
                                transactions = backupData.transactions || [];
                                accounts = backupData.accounts || [];
                                invoices = backupData.invoices || [];
                                budgets = backupData.budgets || [];
                                
                                localStorage.setItem('transactions', JSON.stringify(transactions));
                                localStorage.setItem('accounts', JSON.stringify(accounts));
                                localStorage.setItem('invoices', JSON.stringify(invoices));
                                localStorage.setItem('budgets', JSON.stringify(budgets));
                                
                                loadTransactionsTable();
                                loadAccountsList();
                                updateStats();
                                updateReports();
                                
                                showNotification('Veriler ba≈üarƒ±yla geri y√ºklendi!', 'success');
                            }
                        } catch (error) {
                            showNotification('Yedek dosyasƒ± okunamadƒ±!', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // Saƒü tƒ±k men√ºs√º (context menu) - gelecek √∂zellik
        document.addEventListener('contextmenu', function(e) {
            if (e.target.closest('#transactionsTableBody tr')) {
                e.preventDefault();
                // Saƒü tƒ±k men√ºs√º g√∂sterilebilir
            }
        });

        // Performans optimizasyonu i√ßin debounce fonksiyonu
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Arama fonksiyonunu optimize et
        const debouncedSearch = debounce(searchTransactions, 300);
        document.getElementById('searchInput').addEventListener('keyup', debouncedSearch);

        // Sayfa g√∂r√ºn√ºrl√ºk deƒüi≈üikliklerini izle
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Sayfa gizlendiƒüinde verileri kaydet
                localStorage.setItem('transactions', JSON.stringify(transactions));
                localStorage.setItem('accounts', JSON.stringify(accounts));
                localStorage.setItem('invoices', JSON.stringify(invoices));
                localStorage.setItem('budgets', JSON.stringify(budgets));
            }
        });

        // Konsol komutlarƒ± (geli≈ütirici ara√ßlarƒ± i√ßin)
        window.erpFinance = {
            exportData: () => {
                console.log('Transactions:', transactions);
                console.log('Accounts:', accounts);
                console.log('Invoices:', invoices);
                console.log('Budgets:', budgets);
            },
            clearAllData: () => {
                if (confirm('T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Emin misiniz?')) {
                    localStorage.clear();
                    location.reload();
                }
            },
            addSampleData: () => {
                initializeData();
                location.reload();
            }
        };

        console.log('üí∞ Finans ve Muhasebe Mod√ºl√º y√ºklendi!');
        console.log('üí° Konsol komutlarƒ±: window.erpFinance');
    </script>
</body>
</html>

