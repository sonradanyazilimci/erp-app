<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP - Kalite Kontrol</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-left h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 5px;
        }

        .header-left p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: rgba(149, 165, 166, 0.2);
            color: #2c3e50;
            border: 2px solid rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(149, 165, 166, 0.3);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #138496, #117a8b);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.3);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .quality-table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h2 {
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .search-box {
            padding: 10px 15px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            width: 250px;
            background: rgba(255, 255, 255, 0.8);
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .quality-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .quality-table th,
        .quality-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(149, 165, 166, 0.2);
        }

        .quality-table th {
            background: rgba(52, 152, 219, 0.1);
            color: #2c3e50;
            font-weight: bold;
            font-size: 1rem;
        }

        .quality-table tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .quality-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-passed {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background: #d1ecf1;
            color: #0c5460;
        }

        .priority-critical {
            background: #f8d7da;
            color: #721c24;
        }

        .priority-high {
            background: #fff3cd;
            color: #856404;
        }

        .priority-normal {
            background: #d5f4e6;
            color: #27ae60;
        }

        .quality-form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            height: fit-content;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2c3e50;
            margin: 0;
        }

        .close {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            color: white;
            font-weight: bold;
        }

        .notification.show {
            transform: translateX(0);
        }

        .checklist-container {
            background: rgba(52, 152, 219, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checklist-item.failed {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .checklist-item.passed {
            border-left-color: #27ae60;
            background: #f0f9f0;
        }

        .quality-score {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .score-bar {
            width: 100px;
            height: 8px;
            background: rgba(149, 165, 166, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .score-excellent {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .score-good {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .score-poor {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            background: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .quick-stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .quick-stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .quality-table {
                font-size: 0.9rem;
            }
            
            .quality-table th,
            .quality-table td {
                padding: 10px 8px;
            }

            .stats-row {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .form-row,
            .form-row-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>🔍 Kalite Kontrol</h1>
                <p>Ürün kalitesini kontrol edin ve yönetin</p>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="openAddModal()">
                    ➕ Yeni Kontrol
                </button>
                <a href="dashboard.html" class="btn btn-secondary">
                    🏠 Dashboard'a Dön
                </a>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-icon">🔍</div>
                <div class="stat-number" id="totalControls">0</div>
                <div class="stat-label">Toplam Kontrol</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">✅</div>
                <div class="stat-number" id="passedControls">0</div>
                <div class="stat-label">Geçen Ürün</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">❌</div>
                <div class="stat-number" id="failedControls">0</div>
                <div class="stat-label">Başarısız</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⏳</div>
                <div class="stat-number" id="pendingControls">0</div>
                <div class="stat-label">Bekleyen</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-number" id="qualityRate">0%</div>
                <div class="stat-label">Kalite Oranı</div>
            </div>
        </div>

        <div class="main-content">
            <div class="quality-table-container">
                <div class="table-header">
                    <h2>Kalite Kontrol Listesi</h2>
                    <input type="text" class="search-box" placeholder="🔍 Kontrol ara..." id="searchInput" onkeyup="searchControls()">
                </div>
                
                <table class="quality-table" id="qualityTable">
                    <thead>
                        <tr>
                            <th>Kontrol No</th>
                            <th>Ürün</th>
                            <th>Lot No</th>
                            <th>Kontrol Tarihi</th>
                            <th>Kalite Puanı</th>
                            <th>Durum</th>
                            <th>Öncelik</th>
                            <th>Kontrolcü</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody id="qualityTableBody">
                        <!-- Dinamik olarak doldurulacak -->
                    </tbody>
                </table>
            </div>

            <div class="quality-form-container">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Hızlı Kalite Kontrolü</h2>
                
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="todayControls">0</div>
                        <div class="quick-stat-label">Bugün Kontrol</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="avgQuality">0%</div>
                        <div class="quick-stat-label">Ortalama Kalite</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Kontrol Seç</label>
                    <select id="quickControlSelect" onchange="loadControlDetails()">
                        <option value="">Kontrol seçiniz...</option>
                    </select>
                </div>

                <div id="controlDetails" style="display: none;">
                    <div class="form-group">
                        <label>Kalite Puanı</label>
                        <input type="number" id="qualityScore" placeholder="0-100 arası puan" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label>Kontrol Durumu</label>
                        <select id="controlStatus">
                            <option value="pending">Bekliyor</option>
                            <option value="in-progress">Devam Ediyor</option>
                            <option value="passed">Geçti</option>
                            <option value="failed">Başarısız</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Kontrol Notları</label>
                        <textarea id="controlNotes" placeholder="Kontrol notları..." rows="3"></textarea>
                    </div>

                    <button class="btn btn-success" onclick="updateControl()" style="width: 100%; margin-bottom: 15px;">
                        ✅ Kontrolü Güncelle
                    </button>
                </div>

                <div class="checklist-container">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">📋 Kalite Kontrol Listesi</h3>
                    <div class="checklist-item">
                        <input type="checkbox" id="check1">
                        <label for="check1">Görsel İnceleme</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check2">
                        <label for="check2">Boyut Kontrolü</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check3">
                        <label for="check3">Fonksiyon Testi</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check4">
                        <label for="check4">Dayanıklılık Testi</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check5">
                        <label for="check5">Ambalaj Kontrolü</label>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="openAddModal()" style="width: 100%; margin-bottom: 15px;">
                    🔍 Yeni Kalite Kontrolü
                </button>

                <button class="btn btn-info" onclick="generateReport()" style="width: 100%;">
                    📊 Kalite Raporu Oluştur
                </button>
            </div>
        </div>
    </div>

    <!-- Kalite Kontrol Ekleme/Düzenleme Modal -->
    <div id="qualityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Yeni Kalite Kontrolü</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="qualityForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Kontrol No *</label>
                        <input type="text" id="controlNo" required placeholder="Örn: QC001">
                    </div>
                    <div class="form-group">
                        <label>Lot No</label>
                        <input type="text" id="lotNo" placeholder="Lot numarası">
                    </div>
                </div>

                <div class="form-group">
                    <label>Ürün Adı *</label>
                    <input type="text" id="productName" required placeholder="Kontrol edilecek ürün">
                </div>

                <div class="form-group">
                    <label>Ürün Kategorisi</label>
                    <select id="productCategory">
                        <option value="elektronik">Elektronik</option>
                        <option value="tekstil">Tekstil</option>
                        <option value="gida">Gıda</option>
                        <option value="otomotiv">Otomotiv</option>
                        <option value="makine">Makine</option>
                        <option value="kimya">Kimya</option>
                        <option value="other">Diğer</option>
                    </select>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label>Durum</label>
                        <select id="status">
                            <option value="pending">Bekliyor</option>
                            <option value="in-progress">Devam Ediyor</option>
                            <option value="passed">Geçti</option>
                            <option value="failed">Başarısız</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Öncelik</label>
                        <select id="priority">
                            <option value="normal">Normal</option>
                            <option value="high">Yüksek</option>
                            <option value="critical">Kritik</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Kalite Puanı (0-100)</label>
                        <input type="number" id="score" min="0" max="100" placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Kontrol Tarihi</label>
                        <input type="date" id="controlDate" required>
                    </div>
                    <div class="form-group">
                        <label>Kontrolcü</label>
                        <input type="text" id="inspector" placeholder="Kontrolcü adı">
                    </div>
                </div>

                <div class="form-group">
                    <label>Kontrol Kriterleri</label>
                    <textarea id="criteria" placeholder="Kontrol kriterleri ve standartlar..." rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Kontrol Notları</label>
                    <textarea id="notes" placeholder="Detaylı kontrol notları ve gözlemler..." rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label>Düzeltici Önlemler</label>
                    <textarea id="correctiveActions" placeholder="Gerekli düzeltici önlemler..." rows="3"></textarea>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        ✅ Kaydet
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">
                        ❌ İptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bildirim -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Kalite kontrol verileri
        let qualityData = JSON.parse(localStorage.getItem('qualityData')) || [];
        let editingControlIndex = null;

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            loadQualityTable();
            updateStats();
            loadControlSelects();
            setTodayDate();
            
            document.getElementById('qualityForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveQualityControl();
            });

            document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateChecklistItem);
            });
        });

        // Örnek veri yükleme
        function loadSampleData() {
            if (qualityData.length === 0) {
                qualityData = [
                    {
                        controlNo: 'QC001',
                        productName: 'Smartphone X1',
                        lotNo: 'LOT2024001',
                        category: 'elektronik',
                        controlDate: '2024-07-01',
                        score: 95,
                        status: 'passed',
                        priority: 'normal',
                        inspector: 'Ahmet Yılmaz',
                        criteria: 'Görsel inceleme, fonksiyon testi, dayanıklılık testi',
                        notes: 'Tüm testler başarıyla geçildi. Ürün kalitesi mükemmel.',
                        correctiveActions: 'Herhangi bir düzeltici önlem gerekmiyor.',
                        createdAt: new Date().toISOString()
                    },
                    {
                        controlNo: 'QC002',
                        productName: 'LED TV 55"',
                        lotNo: 'LOT2024002',
                        category: 'elektronik',
                        controlDate: '2024-07-02',
                        score: 78,
                        status: 'failed',
                        priority: 'high',
                        inspector: 'Fatma Demir',
                        criteria: 'Ekran kalitesi, ses sistemi, uzaktan kumanda',
                        notes: 'Ekran parlaklığında sorun tespit edildi. Ses kalitesi düşük.',
                        correctiveActions: 'Ekran ayarları gözden geçirilmeli, ses kartı değiştirilmeli.',
                        createdAt: new Date().toISOString()
                    
                    },
                    {
                        controlNo: 'QC003',
                        productName: 'Pamuklu T-Shirt',
                        lotNo: 'LOT2024003',
                        category: 'tekstil',
                        controlDate: '2024-07-02',
                        score: 88,
                        status: 'passed',
                        priority: 'normal',
                        inspector: 'Mehmet Kaya',
                        criteria: 'Kumaş kalitesi, dikiş kontrolü, renk haslığı',
                        notes: 'Genel kalite iyi. Küçük dikiş hatası mevcut.',
                        correctiveActions: 'Dikiş kalitesi iyileştirilmeli.',
                        createdAt: new Date().toISOString()
                    },
                    {
                        controlNo: 'QC004',
                        productName: 'Organik Zeytinyağı',
                        lotNo: 'LOT2024004',
                        category: 'gida',
                        controlDate: '2024-07-02',
                        score: 92,
                        status: 'passed',
                        priority: 'critical',
                        inspector: 'Ayşe Özkan',
                        criteria: 'Asitlik testi, tat analizi, mikrobiyolojik kontrol',
                        notes: 'Tüm gıda güvenliği testleri başarılı. Mükemmel kalite.',
                        correctiveActions: 'Herhangi bir önlem gerekmiyor.',
                        createdAt: new Date().toISOString()
                    },
                    {
                        controlNo: 'QC005',
                        productName: 'Fren Balata',
                        lotNo: 'LOT2024005',
                        category: 'otomotiv',
                        controlDate: '2024-07-02',
                        score: 65,
                        status: 'pending',
                        priority: 'high',
                        inspector: 'Can Yılmaz',
                        criteria: 'Fren performansı, aşınma testi, ısı dayanımı',
                        notes: 'Test devam ediyor. İlk sonuçlar orta seviyede.',
                        correctiveActions: 'Test tamamlandıktan sonra değerlendirilecek.',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('qualityData', JSON.stringify(qualityData));
            }
        }

        // Kalite kontrol tablosunu yükle
        function loadQualityTable() {
            const tbody = document.getElementById('qualityTableBody');
            tbody.innerHTML = '';

            qualityData.forEach((control, index) => {
                const row = tbody.insertRow();
                const statusClass = `status-${control.status}`;
                const priorityClass = `priority-${control.priority}`;
                
                row.innerHTML = `
                    <td><strong>${control.controlNo}</strong></td>
                    <td>${control.productName}</td>
                    <td>${control.lotNo || '-'}</td>
                    <td>${formatDate(control.controlDate)}</td>
                    <td>
                        <div class="quality-score">
                            <div class="score-bar">
                                <div class="score-fill ${getScoreClass(control.score)}" style="width: ${control.score}%"></div>
                            </div>
                            <span>${control.score}%</span>
                        </div>
                    </td>
                    <td><span class="quality-status ${statusClass}">${getStatusText(control.status)}</span></td>
                    <td><span class="quality-status ${priorityClass}">${getPriorityText(control.priority)}</span></td>
                    <td>${control.inspector || '-'}</td>
                    <td>
                        <button class="btn btn-primary btn-small" onclick="viewControl(${index})">👁️</button>
                        <button class="btn btn-success btn-small" onclick="editControl(${index})">✏️</button>
                        <button class="btn btn-danger btn-small" onclick="deleteControl(${index})">🗑️</button>
                    </td>
                `;
            });
        }

        // İstatistikleri güncelle
        function updateStats() {
            const totalControls = qualityData.length;
            const passedControls = qualityData.filter(c => c.status === 'passed').length;
            const failedControls = qualityData.filter(c => c.status === 'failed').length;
            const pendingControls = qualityData.filter(c => c.status === 'pending').length;
            const qualityRate = totalControls > 0 ? Math.round((passedControls / totalControls) * 100) : 0;

            const today = new Date().toISOString().split('T')[0];
            const todayControls = qualityData.filter(c => c.controlDate === today).length;
            const avgQuality = totalControls > 0 ? 
                Math.round(qualityData.reduce((sum, c) => sum + c.score, 0) / totalControls) : 0;

            document.getElementById('totalControls').textContent = totalControls;
            document.getElementById('passedControls').textContent = passedControls;
            document.getElementById('failedControls').textContent = failedControls;
            document.getElementById('pendingControls').textContent = pendingControls;
            document.getElementById('qualityRate').textContent = qualityRate + '%';
            document.getElementById('todayControls').textContent = todayControls;
            document.getElementById('avgQuality').textContent = avgQuality + '%';
        }

        // Kontrol seçim listelerini yükle
        function loadControlSelects() {
            const quickSelect = document.getElementById('quickControlSelect');
            quickSelect.innerHTML = '<option value="">Kontrol seçiniz...</option>';
            
            qualityData.forEach((control, index) => {
                const option = new Option(`${control.controlNo} - ${control.productName}`, index);
                quickSelect.add(option);
            });
        }

        // Bugünün tarihini ayarla
        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('controlDate').value = today;
        }

        // Modal açma/kapatma fonksiyonları
        function openAddModal() {
            editingControlIndex = null;
            document.getElementById('modalTitle').textContent = 'Yeni Kalite Kontrolü';
            document.getElementById('qualityForm').reset();
            generateControlNo();
            setTodayDate();
            document.getElementById('qualityModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('qualityModal').style.display = 'none';
            editingControlIndex = null;
        }

        // Kontrol numarası oluştur
        function generateControlNo() {
            const nextNumber = qualityData.length + 1;
            const controlNo = 'QC' + String(nextNumber).padStart(3, '0');
            document.getElementById('controlNo').value = controlNo;
        }

        // Kalite kontrolü kaydetme
        function saveQualityControl() {
            const control = {
                controlNo: document.getElementById('controlNo').value,
                productName: document.getElementById('productName').value,
                lotNo: document.getElementById('lotNo').value,
                category: document.getElementById('productCategory').value,
                controlDate: document.getElementById('controlDate').value,
                score: parseInt(document.getElementById('score').value) || 0,
                status: document.getElementById('status').value,
                priority: document.getElementById('priority').value,
                inspector: document.getElementById('inspector').value,
                criteria: document.getElementById('criteria').value,
                notes: document.getElementById('notes').value,
                correctiveActions: document.getElementById('correctiveActions').value,
                createdAt: editingControlIndex !== null ? qualityData[editingControlIndex].createdAt : new Date().toISOString()
            };

            const existingControl = qualityData.find((ctrl, index) => 
                ctrl.controlNo === control.controlNo && index !== editingControlIndex
            );
            
            if (existingControl) {
                showNotification('Bu kontrol numarası zaten mevcut!', 'error');
                return;
            }

            if (editingControlIndex !== null) {
                qualityData[editingControlIndex] = control;
                showNotification('Kalite kontrolü başarıyla güncellendi!', 'success');
            } else {
                qualityData.push(control);
                showNotification('Yeni kalite kontrolü başarıyla eklendi!', 'success');
            }

            localStorage.setItem('qualityData', JSON.stringify(qualityData));
            loadQualityTable();
            loadControlSelects();
            updateStats();
            closeModal();
        }

        // Kontrol işlemleri
        function viewControl(index) {
            const control = qualityData[index];
            alert(`Kalite Kontrol Detayları:\n\nKontrol No: ${control.controlNo}\nÜrün: ${control.productName}\nLot No: ${control.lotNo || '-'}\nKategori: ${getCategoryText(control.category)}\nTarih: ${formatDate(control.controlDate)}\nPuan: ${control.score}%\nDurum: ${getStatusText(control.status)}\nÖncelik: ${getPriorityText(control.priority)}\nKontrolcü: ${control.inspector || '-'}\n\nKriterler:\n${control.criteria || 'Belirtilmemiş'}\n\nNotlar:\n${control.notes || 'Not yok'}\n\nDüzeltici Önlemler:\n${control.correctiveActions || 'Belirtilmemiş'}`);
        }

        function editControl(index) {
            editingControlIndex = index;
            const control = qualityData[index];
            
            document.getElementById('modalTitle').textContent = 'Kalite Kontrolü Düzenle';
            document.getElementById('controlNo').value = control.controlNo;
            document.getElementById('productName').value = control.productName;
            document.getElementById('lotNo').value = control.lotNo;
            document.getElementById('productCategory').value = control.category;
            document.getElementById('controlDate').value = control.controlDate;
            document.getElementById('score').value = control.score;
            document.getElementById('status').value = control.status;
            document.getElementById('priority').value = control.priority;
            document.getElementById('inspector').value = control.inspector;
            document.getElementById('criteria').value = control.criteria;
            document.getElementById('notes').value = control.notes;
            document.getElementById('correctiveActions').value = control.correctiveActions;
            
            document.getElementById('qualityModal').style.display = 'block';
        }

        function deleteControl(index) {
            if (confirm('Bu kalite kontrolünü silmek istediğinizden emin misiniz?')) {
                const control = qualityData[index];
                qualityData.splice(index, 1);
                localStorage.setItem('qualityData', JSON.stringify(qualityData));
                
                loadQualityTable();
                loadControlSelects();
                updateStats();
                showNotification(`${control.controlNo} kontrolü başarıyla silindi!`, 'success');
            }
        }

        // Kontrol detaylarını yükle
        function loadControlDetails() {
            const selectedIndex = document.getElementById('quickControlSelect').value;
            const detailsDiv = document.getElementById('controlDetails');
            
            if (selectedIndex === '') {
                detailsDiv.style.display = 'none';
                return;
            }

            const control = qualityData[selectedIndex];
            document.getElementById('qualityScore').value = control.score;
            document.getElementById('controlStatus').value = control.status;
            document.getElementById('controlNotes').value = control.notes;
            
            detailsDiv.style.display = 'block';
        }

        // Kontrolü güncelle
        function updateControl() {
            const selectedIndex = document.getElementById('quickControlSelect').value;
            if (selectedIndex === '') {
                showNotification('Lütfen bir kontrol seçiniz!', 'error');
                return;
            }

            const control = qualityData[selectedIndex];
            control.score = parseInt(document.getElementById('qualityScore').value) || control.score;
            control.status = document.getElementById('controlStatus').value;
            control.notes = document.getElementById('controlNotes').value;

            localStorage.setItem('qualityData', JSON.stringify(qualityData));
            loadQualityTable();
            updateStats();
            showNotification('Kontrol başarıyla güncellendi!', 'success');
        }

        // Checklist öğesi güncelle
        function updateChecklistItem(event) {
            const item = event.target.closest('.checklist-item');
            if (event.target.checked) {
                item.classList.add('passed');
                item.classList.remove('failed');
            } else {
                item.classList.remove('passed');
            }
        }

        // Arama fonksiyonu
        function searchControls() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#qualityTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Rapor oluştur
        function generateReport() {
            const totalControls = qualityData.length;
            const passedControls = qualityData.filter(c => c.status === 'passed').length;
            const failedControls = qualityData.filter(c => c.status === 'failed').length;
            const avgScore = totalControls > 0 ? 
                Math.round(qualityData.reduce((sum, c) => sum + c.score, 0) / totalControls) : 0;

            let report = 'KALITE KONTROL RAPORU\n';
            report += '========================\n\n';
            report += `Toplam Kontrol: ${totalControls}\n`;
            report += `Başarılı: ${passedControls}\n`;
            report += `Başarısız: ${failedControls}\n`;
            report += `Ortalama Puan: ${avgScore}%\n`;
            report += `Başarı Oranı: ${totalControls > 0 ? Math.round((passedControls / totalControls) * 100) : 0}%\n\n`;
            
            report += 'DETAYLAR:\n';
            report += '----------\n';
            qualityData.forEach(control => {
                report += `${control.controlNo} - ${control.productName}: ${control.score}% (${getStatusText(control.status)})\n`;
            });

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head><title>Kalite Kontrol Raporu</title></head>
                <body style="font-family: monospace; white-space: pre-wrap; padding: 20px;">
                ${report}
                </body>
                </html>
            `);
            
            showNotification('Kalite raporu oluşturuldu!', 'success');
        }

        // Yardımcı fonksiyonlar
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Bekliyor',
                'in-progress': 'Devam Ediyor',
                'passed': 'Geçti',
                'failed': 'Başarısız'
            };
            return statusMap[status] || status;
        }

        function getPriorityText(priority) {
            const priorityMap = {
                'normal': 'Normal',
                'high': 'Yüksek',
                'critical': 'Kritik'
            };
            return priorityMap[priority] || priority;
        }

        function getCategoryText(category) {
            const categoryMap = {
                'elektronik': 'Elektronik',
                'tekstil': 'Tekstil',
                'gida': 'Gıda',
                'otomotiv': 'Otomotiv',
                'makine': 'Makine',
                'kimya': 'Kimya',
                'other': 'Diğer'
            };
            return categoryMap[category] || category;
        }

        function getScoreClass(score) {
            if (score >= 90) return 'score-excellent';
            if (score >= 70) return 'score-good';
            return 'score-poor';
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }

        // Bildirim gösterme
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #27ae60, #229954)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                    break;
                case 'info':
                    notification.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
                    break;
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Modal dışına tıklayınca kapatma
        window.onclick = function(event) {
            const modal = document.getElementById('qualityModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Sayfa animasyonları
        window.addEventListener('load', function() {
            const cards = document.querySelectorAll('.stat-card, .quality-table-container, .quality-form-container');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
